---
phase: 41.1-testing-feedback-round-2-assistant-accuracy-envelopes-ux-research-assistant-styling
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/tools/research-assistant/ResponseDisplay.tsx
  - src/components/tools/research-assistant/ResearchAssistantPage.tsx
autonomous: true
requirements: []

must_haves:
  truths:
    - "Research Assistant response body uses dark text on light background (standard site colors)"
    - "The dark blue header bar on response panels is preserved"
    - "Markdown content renders with standard prose styling (headings, lists, code blocks)"
    - "'Previous in this session' section does NOT appear after only 1 query"
    - "After 2+ queries in the same conversation, prior exchanges appear as a conversation thread"
    - "Follow-up questions append to the thread with all prior exchanges visible"
  artifacts:
    - path: "src/components/tools/research-assistant/ResponseDisplay.tsx"
      provides: "Correct prose styling without prose-invert"
    - path: "src/components/tools/research-assistant/ResearchAssistantPage.tsx"
      provides: "Session history with 2+ query threshold and conversation thread display"
  key_links:
    - from: "src/components/tools/research-assistant/ResearchAssistantPage.tsx"
      to: "ResponseDisplay"
      via: "state prop rendering"
      pattern: "ResponseDisplay.*state="
---

<objective>
Fix two Research Assistant UX issues: (1) remove prose-invert class from response body so text displays as dark-on-light with standard site styling, (2) fix session history to only show after 2+ queries and display as a chronological conversation thread.

Purpose: Make Research Assistant responses readable with correct colors and improve the session history UX to avoid duplicate display after the first query.
Output: Updated ResponseDisplay and ResearchAssistantPage components.
</objective>

<execution_context>
@/Users/dweinbeck/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dweinbeck/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/components/tools/research-assistant/ResponseDisplay.tsx
@src/components/tools/research-assistant/ResearchAssistantPage.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix ResponseDisplay body text colors and prose styling</name>
  <files>src/components/tools/research-assistant/ResponseDisplay.tsx</files>
  <action>
In the ModelPanel component's body section:

1. **Remove `prose-invert` from the markdown container**: Change `prose prose-invert max-w-none text-sm` to `prose max-w-none text-sm` on the div wrapping the `<Markdown>` component (line 109). This removes the white-on-dark text inversion.

2. **Keep the dark blue header bar (`bg-primary`)**: The `<header>` element with `bg-primary` and white text stays exactly as-is. Only the body content area changes.

3. **Verify prose styling works for standard theme**: The `prose` class from Tailwind typography plugin applies dark text on light background by default, which is what we want. Headings, lists, code blocks, blockquotes should all render with the site's standard dark text colors.

4. **Optional: Add `prose-sm` for consistent small text sizing** if `text-sm` alone doesn't produce the right size with prose styles. Test by checking that `prose max-w-none text-sm` renders cleanly.
  </action>
  <verify>npm run lint && npm run build</verify>
  <done>Response body text renders as dark text on light background. Header bar remains dark blue with white text. Markdown headings, lists, and code blocks use standard site typography.</done>
</task>

<task type="auto">
  <name>Task 2: Fix session history to show after 2+ queries as conversation thread</name>
  <files>src/components/tools/research-assistant/ResearchAssistantPage.tsx</files>
  <action>
Modify the session history behavior in ResearchAssistantContent:

1. **Change display threshold from 1 to 2**: The session history section currently renders when `sessionHistory.length > 0`. Change this condition to `sessionHistory.length > 1` so that the "Previous in this session" heading does NOT appear after only 1 query.

   Update the conditional on line 254 from:
   ```tsx
   {sessionHistory.length > 0 && (
   ```
   to:
   ```tsx
   {sessionHistory.length > 1 && (
   ```

2. **Reverse display order for conversation thread feel**: Currently `sessionHistory` is built with newest first (`[newEntry, ...prev]`). For a conversation thread (latest at bottom, scroll up for history), reverse this:
   - Change `setSessionHistory` to append instead of prepend: `[...prev, newEntry]` instead of `[newEntry, ...prev]`.
   - In the render, display `sessionHistory.slice(0, -1)` (all entries EXCEPT the last one, since the last one is the currently displayed response). This avoids duplicate display of the current response.

3. **Rename section heading**: Change "Previous in this session" to "Conversation Thread" for better UX clarity.

4. **Display in chronological order**: Since entries are now in chronological order (oldest first), the `.slice(0, -1)` renders oldest exchanges first and newest at bottom — which is the natural conversation thread pattern. Users scroll up for older history.

5. **Ensure follow-up questions appear in the thread**: The existing `useEffect` that saves to `sessionHistory` already fires on `state.overallStatus` changes, which includes follow-up responses. After a follow-up, the previous exchange gets added to history and the new response displays in the main panel. This is the desired behavior — follow-ups append to the thread with all prior exchanges remaining visible.
  </action>
  <verify>npm run lint && npm run build</verify>
  <done>"Previous in this session" (now "Conversation Thread") does not appear after only 1 query. After 2+ queries, prior exchanges display in chronological order as a conversation thread. Follow-up questions append to the thread.</done>
</task>

</tasks>

<verification>
1. `npm run lint` passes with zero errors
2. `npm run build` succeeds
3. Response body text is dark on light background
4. Dark blue header bar on response panels is preserved
5. Session history section hidden after first query, visible after second
6. Thread displays in chronological order (oldest first)
</verification>

<success_criteria>
- No `prose-invert` on response body — text is readable dark-on-light
- Header bars remain `bg-primary` with white text
- Session history hidden after only 1 query
- After 2+ queries, conversation thread shows all prior exchanges in order
- Follow-up questions append naturally to the thread
</success_criteria>

<output>
After completion, create `.planning/phases/41.1-testing-feedback-round-2-assistant-accuracy-envelopes-ux-research-assistant-styling/41.1-03-SUMMARY.md`
</output>
