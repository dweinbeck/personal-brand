---
phase: 21-brand-scraper-ui
plan: 02
type: execute
wave: 2
depends_on: ["21-01"]
files_modified:
  - src/components/admin/brand-scraper/ColorPaletteCard.tsx
  - src/components/admin/brand-scraper/TypographyCard.tsx
  - src/components/admin/brand-scraper/LogoAssetsCard.tsx
  - src/components/admin/brand-scraper/DownloadLinks.tsx
  - src/components/admin/brand-scraper/BrandResultsGallery.tsx
  - src/components/admin/brand-scraper/BrandScraperPage.tsx
  - src/app/control-center/brand-scraper/page.tsx
autonomous: true

must_haves:
  truths:
    - "Admin can type a URL and submit it to start a scrape job"
    - "After submission, the UI shows a polling status indicator (queued/processing) that updates automatically"
    - "When the job succeeds, a 2-wide card gallery displays extracted colors, fonts, logos, and assets"
    - "Color swatches show hex codes and copy-to-clipboard on click"
    - "Font cards show family names"
    - "Logo and asset cards show image thumbnails"
    - "Download links for brand.json and assets.zip appear when the job succeeds"
    - "Confidence badges appear on items with confidence scores"
    - "Polling stops automatically on terminal states and does not leak on navigation"
  artifacts:
    - path: "src/components/admin/brand-scraper/ColorPaletteCard.tsx"
      provides: "Color swatches with hex codes and click-to-copy"
      exports: ["ColorPaletteCard"]
    - path: "src/components/admin/brand-scraper/TypographyCard.tsx"
      provides: "Font family display with weight info"
      exports: ["TypographyCard"]
    - path: "src/components/admin/brand-scraper/LogoAssetsCard.tsx"
      provides: "Logo and asset image thumbnail grid"
      exports: ["LogoAssetsCard"]
    - path: "src/components/admin/brand-scraper/DownloadLinks.tsx"
      provides: "Download buttons for brand.json and assets.zip"
      exports: ["DownloadLinks"]
    - path: "src/components/admin/brand-scraper/BrandResultsGallery.tsx"
      provides: "2-wide card grid assembling all gallery sections"
      exports: ["BrandResultsGallery"]
    - path: "src/components/admin/brand-scraper/BrandScraperPage.tsx"
      provides: "Client orchestrator managing form -> polling -> results flow"
      exports: ["BrandScraperPage"]
    - path: "src/app/control-center/brand-scraper/page.tsx"
      provides: "RSC page rendering BrandScraperPage"
  key_links:
    - from: "src/components/admin/brand-scraper/BrandScraperPage.tsx"
      to: "src/components/admin/brand-scraper/UrlSubmitForm.tsx"
      via: "import and render with onJobSubmitted callback"
      pattern: "UrlSubmitForm"
    - from: "src/components/admin/brand-scraper/BrandScraperPage.tsx"
      to: "src/lib/brand-scraper/hooks.ts"
      via: "import useJobStatus for polling"
      pattern: "useJobStatus"
    - from: "src/components/admin/brand-scraper/BrandScraperPage.tsx"
      to: "src/components/admin/brand-scraper/BrandResultsGallery.tsx"
      via: "render when job status is succeeded"
      pattern: "BrandResultsGallery"
    - from: "src/components/admin/brand-scraper/BrandResultsGallery.tsx"
      to: "src/components/admin/brand-scraper/ColorPaletteCard.tsx"
      via: "import and render with result.colors"
      pattern: "ColorPaletteCard"
    - from: "src/app/control-center/brand-scraper/page.tsx"
      to: "src/components/admin/brand-scraper/BrandScraperPage.tsx"
      via: "import and render as default export"
      pattern: "BrandScraperPage"
---

<objective>
Build the brand data gallery sub-components, the results gallery grid, the page orchestrator, and wire everything into the route page.

Purpose: This plan assembles the complete brand scraper UI by creating the visual gallery components (colors, fonts, logos/assets, downloads), composing them into a 2-wide card grid, building the orchestrator that manages the form-to-polling-to-results state machine, and replacing the stub page with the working UI.

Output: Complete brand scraper page at `/control-center/brand-scraper` with URL submission, job polling, and results gallery.
</objective>

<execution_context>
@/Users/dweinbeck/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dweinbeck/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-brand-scraper-ui/21-RESEARCH.md
@.planning/phases/21-brand-scraper-ui/21-01-SUMMARY.md

# Phase 20 artifacts
@src/lib/brand-scraper/types.ts
@src/lib/brand-scraper/hooks.ts

# Plan 01 components
@src/components/admin/brand-scraper/UrlSubmitForm.tsx
@src/components/admin/brand-scraper/JobStatusIndicator.tsx
@src/components/admin/brand-scraper/BrandConfidenceBadge.tsx

# Existing patterns
@src/components/ui/Card.tsx
@src/components/ui/Button.tsx
@src/context/AuthContext.tsx
@src/app/control-center/brand-scraper/page.tsx
@src/app/control-center/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Gallery sub-components (ColorPaletteCard, TypographyCard, LogoAssetsCard, DownloadLinks)</name>
  <files>src/components/admin/brand-scraper/ColorPaletteCard.tsx, src/components/admin/brand-scraper/TypographyCard.tsx, src/components/admin/brand-scraper/LogoAssetsCard.tsx, src/components/admin/brand-scraper/DownloadLinks.tsx</files>
  <action>
All four files are `"use client"` components. Import the `BrandTaxonomy` type from `@/lib/brand-scraper/types` for prop typing. Import `BrandConfidenceBadge` from `./BrandConfidenceBadge` where confidence display is needed.

**ColorPaletteCard.tsx:**

Props: `{ colors: BrandTaxonomy["colors"] }` (the optional colors array from the taxonomy).

If `!colors || colors.length === 0`, render an empty state: `<p className="text-sm text-text-tertiary">No colors detected.</p>`

Otherwise render a grid of color swatches. Each swatch is a `<button>` (click-to-copy hex):
- Layout: `grid grid-cols-2 gap-3 sm:grid-cols-3`
- Each swatch: flex row with a colored square (`h-10 w-10 rounded-lg border border-border shadow-sm`, `style={{ backgroundColor: hex }}`), the hex code in mono font, optional name below in secondary text, and a BrandConfidenceBadge at the end.
- On click: wrap `navigator.clipboard.writeText(hex)` in try/catch. On success, briefly show a "Copied!" text or change the button state for 1.5 seconds (use useState with setTimeout). On failure (non-HTTPS), silently fail.
- Use `hover:bg-gold-light transition-colors` on the swatch button for hover feedback.
- Add a heading: `<h3 className="text-sm font-semibold text-text-primary mb-3">Colors</h3>`

**TypographyCard.tsx:**

Props: `{ fonts: BrandTaxonomy["fonts"] }` (the optional fonts array).

If `!fonts || fonts.length === 0`, render empty state.

Otherwise render a list of font entries:
- Layout: `space-y-4`
- Each font: display the `family` name in `font-semibold text-text-primary`, weights as a comma-separated list in secondary text (e.g., "Weights: 400, 500, 700"), usage in tertiary text if present, and a BrandConfidenceBadge.
- Do NOT attempt to load fonts from Google Fonts dynamically (per research pitfall 6 -- layout shift). Just display the family name as text.
- If `source` field is "google_fonts", show a small link to `https://fonts.google.com/specimen/${family}` (URL-encode family name).
- Add heading: `<h3 className="text-sm font-semibold text-text-primary mb-3">Typography</h3>`

**LogoAssetsCard.tsx:**

Props: `{ logos: BrandTaxonomy["logos"]; assets: BrandTaxonomy["assets"] }` (both optional arrays).

If both are empty/undefined, render empty state.

Render two sections:

Logos section (if logos exist):
- Heading: `<h3 className="text-sm font-semibold text-text-primary mb-3">Logos</h3>`
- Grid: `grid grid-cols-2 gap-3`
- Each logo: plain `<img>` tag (NOT next/image -- GCS signed URLs have dynamic hostnames, per research). Set `src={logo.url}`, `loading="lazy"`, `alt="Logo"`, constrain with `max-h-24 w-full object-contain`. Show format badge if present. Show BrandConfidenceBadge.
- Wrap each in a small card-like container with border and padding.

Assets section (if assets exist):
- Heading: `<h3 className="text-sm font-semibold text-text-primary mb-3 mt-4">Assets</h3>`
- Grid: `grid grid-cols-2 gap-3`
- Each asset: plain `<img>` with `src={asset.url}`, `loading="lazy"`, `alt={asset.type || "Asset"}`, same sizing constraints. Show type label if present.

**DownloadLinks.tsx:**

Props: `{ brandJsonUrl?: string; assetsZipUrl?: string }`.

If neither URL is provided, render nothing (return null).

Render download buttons using the `Button` component from `@/components/ui/Button`:
- Layout: `flex flex-col gap-3 sm:flex-row`
- brand.json: `<Button href={brandJsonUrl} variant="secondary" size="sm">` with download icon (inline SVG arrow-down, ~16x16) and text "Download Brand Data (JSON)". Add `download="brand.json"` attribute. Since Button renders as `<a>` when href is provided, this works. However, Button's `<a>` uses Link for internal and plain `<a>` for external -- GCS URLs are external, so it will use plain `<a>`. Add the `download` attribute via rest props.
- assets.zip: Same pattern with text "Download Assets (ZIP)" and `download="assets.zip"`.
- Add heading: `<h3 className="text-sm font-semibold text-text-primary mb-3">Downloads</h3>`

NOTE: The Button component spreads `...rest` onto the `<a>` element, so `download` attribute will pass through.
  </action>
  <verify>
Run `npx tsc --noEmit` -- all four files compile. Run `npm run lint` -- no Biome errors. Verify each file has `"use client"` directive and named exports.
  </verify>
  <done>ColorPaletteCard renders color swatches with hex codes, click-to-copy, and confidence badges. TypographyCard shows font families with weights and optional Google Fonts link. LogoAssetsCard displays logo/asset thumbnails with plain img tags. DownloadLinks provides brand.json and assets.zip download buttons.</done>
</task>

<task type="auto">
  <name>Task 2: BrandResultsGallery, BrandScraperPage orchestrator, and page wiring</name>
  <files>src/components/admin/brand-scraper/BrandResultsGallery.tsx, src/components/admin/brand-scraper/BrandScraperPage.tsx, src/app/control-center/brand-scraper/page.tsx</files>
  <action>
**Create `src/components/admin/brand-scraper/BrandResultsGallery.tsx`:**

`"use client"` component. Assembles the gallery sub-components into a 2-wide responsive card grid.

Props: `{ result: BrandTaxonomy; brandJsonUrl?: string; assetsZipUrl?: string }` (import BrandTaxonomy from types).

Render:
```tsx
<div className="space-y-6">
  <h2 className="text-lg font-semibold text-text-primary">Results</h2>
  <div className="grid gap-6 sm:grid-cols-2">
    <Card>
      <ColorPaletteCard colors={result.colors} />
    </Card>
    <Card>
      <TypographyCard fonts={result.fonts} />
    </Card>
    <Card>
      <LogoAssetsCard logos={result.logos} assets={result.assets} />
    </Card>
    <Card>
      <DownloadLinks brandJsonUrl={brandJsonUrl} assetsZipUrl={assetsZipUrl} />
    </Card>
  </div>
</div>
```

Import `Card` from `@/components/ui/Card`. Import all four sub-components from their sibling files.

**Create `src/components/admin/brand-scraper/BrandScraperPage.tsx`:**

`"use client"` component. This is the page orchestrator managing the full lifecycle: idle -> submitting -> polling -> complete/failed.

Imports:
- `useState` from React
- `useAuth` from `@/context/AuthContext`
- `useJobStatus` from `@/lib/brand-scraper/hooks`
- `UrlSubmitForm` from `./UrlSubmitForm`
- `JobStatusIndicator` from `./JobStatusIndicator`
- `BrandResultsGallery` from `./BrandResultsGallery`
- `Button` from `@/components/ui/Button`
- Type `ScrapeJobSubmission` from `@/lib/brand-scraper/types`

State:
- `jobId: string | null` (null = idle, set after form submission)
- `token: string | null` (obtained from auth, cached for polling)

Auth setup: Use `useAuth()` to get `user`. When `onJobSubmitted` fires, get token via `await user?.getIdToken()` and store it in state alongside the jobId.

Hook: `const { data, error, isLoading, isPolling, isTerminal, isTimedOut, reset } = useJobStatus(jobId, token);`

`handleJobSubmitted(job: ScrapeJobSubmission)` callback:
- Get token from `user?.getIdToken()` -- store in token state.
- Set `jobId` to `job.job_id`.

`handleNewScrape()` callback (for "Scrape Another" button):
- Call `reset()` on the hook.
- Set `jobId` to null, `token` to null.

Render layout (max-w-4xl centered, matching TutorialEditor pattern):

```
<div className="mx-auto max-w-4xl px-4 sm:px-6 lg:px-8 py-12">
  <h1>Brand Scraper</h1>

  {/* Always show the form when idle (no jobId) */}
  {!jobId && <UrlSubmitForm onJobSubmitted={handleJobSubmitted} />}

  {/* Show status + results when a job is active */}
  {jobId && (
    <>
      <JobStatusIndicator
        status={data?.status ?? "queued"}
        isPolling={isPolling}
        isTimedOut={isTimedOut}
        error={error?.message ?? null}
      />

      {/* Show gallery when succeeded and result exists */}
      {data?.status === "succeeded" && data.result && (
        <BrandResultsGallery
          result={data.result}
          brandJsonUrl={data.brand_json_url}
          assetsZipUrl={data.assets_zip_url}
        />
      )}

      {/* Show partial results gallery too */}
      {data?.status === "partial" && data.result && (
        <BrandResultsGallery
          result={data.result}
          brandJsonUrl={data.brand_json_url}
          assetsZipUrl={data.assets_zip_url}
        />
      )}

      {/* Show error details when failed */}
      {data?.status === "failed" && data.error && (
        <p className="mt-4 text-sm text-red-600">{data.error}</p>
      )}

      {/* New scrape button when terminal */}
      {isTerminal && (
        <div className="mt-6">
          <Button variant="secondary" onClick={handleNewScrape}>
            Scrape Another URL
          </Button>
        </div>
      )}

      {/* Manual retry when timed out */}
      {isTimedOut && !isTerminal && (
        <div className="mt-4">
          <Button variant="secondary" onClick={() => reset()}>
            Check Again
          </Button>
        </div>
      )}
    </>
  )}
</div>
```

Heading: `<h1 className="text-2xl font-bold text-gray-900 mb-6">Brand Scraper</h1>` (same style as TutorialEditor heading).

**Update `src/app/control-center/brand-scraper/page.tsx`:**

Replace the entire stub with a thin RSC wrapper:

```typescript
import { BrandScraperPage } from "@/components/admin/brand-scraper/BrandScraperPage";

export default function Page() {
  return <BrandScraperPage />;
}
```

This is a server component that renders the client component. The layout.tsx already wraps it with AdminGuard and ControlCenterNav.
  </action>
  <verify>
Run `npx tsc --noEmit` -- all files compile. Run `npm run lint` -- no Biome errors. Run `npm run build` -- build succeeds with no errors. Verify `src/app/control-center/brand-scraper/page.tsx` imports and renders `BrandScraperPage`.
  </verify>
  <done>BrandResultsGallery composes ColorPaletteCard, TypographyCard, LogoAssetsCard, and DownloadLinks in a 2-wide Card grid. BrandScraperPage orchestrates the form -> polling -> results flow using useJobStatus hook. The stub page.tsx is replaced with a thin RSC wrapper rendering BrandScraperPage. Full quality gates pass.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero type errors
2. `npm run lint` passes with zero Biome errors
3. `npm run build` succeeds
4. `/control-center/brand-scraper` page renders BrandScraperPage (not the stub)
5. BrandScraperPage imports and uses UrlSubmitForm, JobStatusIndicator, BrandResultsGallery
6. BrandResultsGallery imports and renders ColorPaletteCard, TypographyCard, LogoAssetsCard, DownloadLinks
7. BrandScraperPage uses useJobStatus hook for polling and passes auth token
8. Gallery uses Card component from ui/ for consistent styling
9. No `next/image` used for logo/asset display (plain `<img>` per research)
10. Download links use external `<a>` tags with `download` attribute
</verification>

<success_criteria>
- Brand scraper page at `/control-center/brand-scraper` renders the full UI (not the stub)
- URL form submission triggers job creation and transitions to polling view
- Status indicator shows animated indicators for queued/processing states
- Succeeded/partial jobs display a 2-wide card gallery with colors, fonts, logos, assets
- Color swatches show hex with copy-to-clipboard
- Font cards show family names with optional Google Fonts links
- Logo/asset cards show thumbnails via plain img tags
- Download links for brand.json and assets.zip appear when available
- Confidence badges appear on items with scores
- "Scrape Another URL" button resets the page to idle state
- All quality gates pass: tsc, lint, build
</success_criteria>

<output>
After completion, create `.planning/phases/21-brand-scraper-ui/21-02-SUMMARY.md`
</output>
