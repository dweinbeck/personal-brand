---
phase: 11-github-api-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/data/projects.json
  - src/types/project.ts
  - src/lib/github.ts
autonomous: true

must_haves:
  truths:
    - "Project config maps curated metadata to GitHub repos"
    - "GitHub API can fetch individual repo data with ISR caching"
    - "GitHub API can fetch README content for detail pages"
    - "Types support both curated config and enriched API data"
  artifacts:
    - path: "src/data/projects.json"
      provides: "Curated project config with GitHub repo mapping"
      contains: "repo"
    - path: "src/types/project.ts"
      provides: "ProjectConfig and EnrichedProject interfaces"
      exports: ["ProjectConfig", "EnrichedProject"]
    - path: "src/lib/github.ts"
      provides: "GitHub API functions with ISR caching"
      exports: ["fetchProjectBySlug", "fetchAllProjects", "fetchReadme"]
  key_links:
    - from: "src/lib/github.ts"
      to: "src/data/projects.json"
      via: "import and merge"
      pattern: "import.*projects\\.json"
    - from: "src/lib/github.ts"
      to: "api.github.com"
      via: "fetch with ISR"
      pattern: "fetch.*api\\.github\\.com"
---

<objective>
Establish the data layer for GitHub API integration with curated project configuration.

Purpose: Create the foundation that projects page, detail pages, and homepage will consume. Separates curated metadata (which projects to show, featured flag, status) from live GitHub data (dates, README, stats).

Output: Updated projects.json with repo mapping, expanded types, and GitHub API functions for fetching individual repos and README content.
</objective>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-github-api-integration/11-RESEARCH.md

@src/lib/github.ts
@src/data/projects.json
@src/types/project.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install react-markdown and update project config</name>
  <files>
    - package.json
    - src/data/projects.json
    - src/types/project.ts
  </files>
  <action>
1. Install react-markdown:
   ```bash
   npm install react-markdown
   ```
   Note: remark-gfm already installed.

2. Update `src/types/project.ts` with new interfaces:
   ```typescript
   // Curated config from projects.json
   export interface ProjectConfig {
     slug: string;              // URL slug (e.g., "personal-brand")
     repo: string | null;       // GitHub "owner/repo" or null for private
     featured: boolean;         // Show on homepage
     status: "Live" | "In Development" | "Planning";
     name: string;              // Display name
     description: string;       // Custom description
     tags: string[];            // Tech tags for filtering
   }

   // Enriched with GitHub API data
   export interface EnrichedProject extends ProjectConfig {
     // From GitHub API (null if private/unavailable)
     language: string | null;
     stars: number;
     url: string | null;        // GitHub URL
     homepage: string | null;   // Live site URL
     topics: string[];          // GitHub topics
     createdAt: string | null;  // ISO date
     pushedAt: string | null;   // ISO date (last commit)
     visibility: "public" | "private";
   }

   // Keep existing Project interface for backwards compatibility
   export interface Project {
     name: string;
     description: string;
     language: string | null;
     stars: number;
     url: string;
     homepage: string | null;
     topics: string[];
   }
   ```

3. Update `src/data/projects.json` with GitHub repo mapping and featured flags:
   - Add `slug` field (URL-safe identifier)
   - Add `repo` field ("dweinbeck/repo-name" or null for private)
   - Add `featured` boolean (true for first 3-4 projects)
   - Keep existing name, description, tags, status
   - Remove the `url` field (will come from GitHub API)

   Example transformation:
   ```json
   {
     "slug": "personal-brand",
     "repo": "dweinbeck/personal-brand",
     "featured": true,
     "status": "Live",
     "name": "Personal Brand Website",
     "description": "This very site â€” built with Next.js 16...",
     "tags": ["Next.js", "TypeScript", "Firebase", "GCP"]
   }
   ```

   For private repos, set `repo: null` and the API will return curated-only data.
  </action>
  <verify>
    - `npm ls react-markdown` shows installed version
    - `npx tsc --noEmit` passes (types are valid)
    - projects.json has slug, repo, featured fields for all entries
  </verify>
  <done>
    - react-markdown installed
    - ProjectConfig and EnrichedProject interfaces defined
    - projects.json updated with GitHub repo mapping
  </done>
</task>

<task type="auto">
  <name>Task 2: Expand GitHub API functions</name>
  <files>src/lib/github.ts</files>
  <action>
Rewrite `src/lib/github.ts` to support the new data architecture:

1. Import project config:
   ```typescript
   import projectConfig from "@/data/projects.json";
   import type { ProjectConfig, EnrichedProject, Project } from "@/types/project";
   ```

2. Add GitHub API response interface:
   ```typescript
   interface GitHubRepoResponse {
     name: string;
     description: string | null;
     language: string | null;
     stargazers_count: number;
     html_url: string;
     homepage: string | null;
     topics: string[];
     created_at: string;
     pushed_at: string;
     visibility: string;
     private: boolean;
   }
   ```

3. Add `fetchGitHubRepo` helper (internal):
   ```typescript
   async function fetchGitHubRepo(owner: string, repo: string): Promise<GitHubRepoResponse | null> {
     const res = await fetch(
       `https://api.github.com/repos/${owner}/${repo}`,
       {
         headers: { Accept: "application/vnd.github+json" },
         next: { revalidate: 3600 }, // 1 hour ISR
       }
     );
     if (!res.ok) {
       console.error(`GitHub API error for ${owner}/${repo}: ${res.status}`);
       return null;
     }
     return res.json();
   }
   ```

4. Add `fetchReadme` function (exported):
   ```typescript
   export async function fetchReadme(owner: string, repo: string): Promise<string | null> {
     const res = await fetch(
       `https://api.github.com/repos/${owner}/${repo}/readme`,
       {
         headers: { Accept: "application/vnd.github.raw+json" },
         next: { revalidate: 3600 },
       }
     );
     if (!res.ok) return null;
     return res.text();
   }
   ```

5. Add `fetchAllProjects` function (exported):
   - Reads from projectConfig
   - For each project with repo != null, fetches GitHub data
   - Merges curated + API data into EnrichedProject[]
   - Private repos get curated data only with visibility: "private"

6. Add `fetchProjectBySlug` function (exported):
   - Finds project in config by slug
   - Returns null if not found
   - Enriches with GitHub data if repo is not null

7. Keep existing `fetchGitHubProjects` for backwards compatibility (or deprecate if not used elsewhere).
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - `npm run build` succeeds
    - Can import { fetchAllProjects, fetchProjectBySlug, fetchReadme } from "@/lib/github"
  </verify>
  <done>
    - fetchAllProjects returns EnrichedProject[] with merged curated + API data
    - fetchProjectBySlug returns single EnrichedProject or null
    - fetchReadme returns raw markdown string or null
    - All functions use ISR caching (3600s)
  </done>
</task>

</tasks>

<verification>
After completing all tasks:
1. Run `npm run build` - should succeed without errors
2. Check that new exports work:
   ```bash
   # In a test file or REPL, verify imports don't error
   npx tsc --noEmit
   ```
3. Verify projects.json structure is valid JSON with required fields
</verification>

<success_criteria>
- react-markdown is installed
- ProjectConfig and EnrichedProject types are defined and exported
- projects.json has slug, repo, featured, status, name, description, tags for all projects
- fetchAllProjects, fetchProjectBySlug, fetchReadme are exported from github.ts
- Build passes with no type errors
</success_criteria>

<output>
After completion, create `.planning/phases/11-github-api-integration/11-01-SUMMARY.md`
</output>
