---
phase: 47-feature-parity-and-demo-mode
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/apps/tasks/today/page.tsx
  - src/app/apps/tasks/completed/page.tsx
  - src/app/apps/tasks/completed/completed-view.tsx
  - src/app/apps/tasks/search/page.tsx
  - src/app/apps/tasks/search/search-input.tsx
  - src/components/tasks/quick-add-modal.tsx
  - src/components/tasks/sidebar.tsx
  - src/data/help-tips.ts
  - src/lib/hooks/use-tooltip-position.ts
  - src/components/tasks/ui/help-tip.tsx
autonomous: true
requirements: [FP-06, FP-07, FP-08, FP-09, FP-10]

must_haves:
  truths:
    - "Today view at /apps/tasks/today shows tasks with deadlines due today"
    - "Completed view at /apps/tasks/completed shows completed tasks with optional project filter"
    - "Search at /apps/tasks/search returns matching tasks by name/description"
    - "Quick-add modal opens from sidebar Add Task button and creates tasks in any project"
    - "Help tip icons appear next to key UI elements with informative tooltips on hover/click"
  artifacts:
    - path: "src/app/apps/tasks/today/page.tsx"
      provides: "Today smart view"
    - path: "src/app/apps/tasks/completed/completed-view.tsx"
      provides: "Completed tasks view with project filter"
    - path: "src/app/apps/tasks/search/search-input.tsx"
      provides: "Search input with URL-based query"
    - path: "src/components/tasks/quick-add-modal.tsx"
      provides: "Quick add task modal"
    - path: "src/components/tasks/ui/help-tip.tsx"
      provides: "Help tip tooltip component"
    - path: "src/data/help-tips.ts"
      provides: "Help tip text catalog"
  key_links:
    - from: "src/app/apps/tasks/today/page.tsx"
      to: "src/services/tasks/task.service.ts"
      via: "getTasksForToday"
      pattern: "getTasksForToday"
    - from: "src/app/apps/tasks/completed/page.tsx"
      to: "src/services/tasks/task.service.ts"
      via: "getCompletedTasks"
      pattern: "getCompletedTasks"
    - from: "src/app/apps/tasks/search/page.tsx"
      to: "src/services/tasks/task.service.ts"
      via: "searchTasks"
      pattern: "searchTasks"
    - from: "src/components/tasks/quick-add-modal.tsx"
      to: "@/actions/tasks/task"
      via: "createTaskAction"
      pattern: "createTaskAction"
---

<objective>
Verify and fix remaining feature parity (Today view, Completed view, Search, Quick-add modal) and create help tips feature for key UI elements.

Purpose: Ensure all smart views and utility features work correctly, and add help tips to guide new users through the Tasks app interface.
Output: All smart views verified working, Quick-add modal functional, and help tip tooltips placed on key UI elements.
</objective>

<execution_context>
@/Users/dweinbeck/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dweinbeck/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/45-ui-components-routing/45-02-SUMMARY.md
@.planning/phases/31-help-tips/31-01-SUMMARY.md

Key files to examine:
@src/app/apps/tasks/today/page.tsx
@src/app/apps/tasks/completed/page.tsx
@src/app/apps/tasks/completed/completed-view.tsx
@src/app/apps/tasks/search/page.tsx
@src/app/apps/tasks/search/search-input.tsx
@src/components/tasks/quick-add-modal.tsx
@src/components/tasks/sidebar.tsx
@src/services/tasks/task.service.ts
@src/services/tasks/project.service.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify smart views and Quick-add modal</name>
  <files>
    src/app/apps/tasks/today/page.tsx
    src/app/apps/tasks/completed/page.tsx
    src/app/apps/tasks/completed/completed-view.tsx
    src/app/apps/tasks/search/page.tsx
    src/app/apps/tasks/search/search-input.tsx
    src/components/tasks/quick-add-modal.tsx
    src/components/tasks/sidebar.tsx
  </files>
  <action>
    Verify all smart views and utility features work correctly:

    1. **Today view** (`/apps/tasks/today`): Verify `getTasksForToday(userId)` exists in task.service.ts and queries tasks where `deadlineAt` falls within today's date range. Confirm tasks are filtered to include only non-completed tasks with today's deadline. Verify TaskCard renders with all needed props.

    2. **Completed view** (`/apps/tasks/completed`): Verify `getCompletedTasks(userId, projectId?)` exists in task.service.ts. Confirm it queries tasks where `status === 'COMPLETED'`, optionally filtered by projectId. Verify `CompletedView` client component renders a project filter dropdown and the task list. Confirm `getAllProjects(userId)` is called for the filter dropdown.

    3. **Search** (`/apps/tasks/search`): Verify `searchTasks(userId, query)` exists in task.service.ts. Confirm it does a case-insensitive search on task name and/or description using Prisma `contains` with `mode: 'insensitive'`. Verify `SearchInput` uses URL-based search params (navigates to `/apps/tasks/search?q=...`).

    4. **Quick-add modal**: Verify `QuickAddModal` in sidebar.tsx:
       - Opens when "Add Task" button in sidebar is clicked
       - Receives `workspaces` and `allTags` props from sidebar
       - Calls `createTaskAction(token, {...})` with project, name, description, deadline, effort, tagIds
       - Closes and resets form on success

    5. **Service function verification**: For each service function called by the views, verify:
       - Function exists with correct signature
       - Prisma query includes necessary relations (tags, subtasks for TaskWithRelations type)
       - Tasks are properly filtered (today = deadline in range, completed = status COMPLETED, search = name/description contains)

    6. **Fix any issues**: Missing service functions, wrong Prisma includes, incorrect URL paths in search-input.tsx (should be /apps/tasks/search), missing task relations in query results.
  </action>
  <verify>
    - `npm run build` succeeds
    - `npm run lint` passes
    - `grep -r "getTasksForToday\|getCompletedTasks\|searchTasks" src/services/tasks/task.service.ts` shows all three functions
    - `grep "/apps/tasks/search" src/app/apps/tasks/search/search-input.tsx` confirms correct URL path
  </verify>
  <done>
    Today view correctly filters tasks by today's deadline, Completed view shows completed tasks with project filter dropdown, Search returns matching tasks, and Quick-add modal creates tasks from any page via sidebar. All smart view service functions exist and include proper Prisma relations.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create help tips feature</name>
  <files>
    src/data/help-tips.ts
    src/lib/hooks/use-tooltip-position.ts
    src/components/tasks/ui/help-tip.tsx
    src/components/tasks/sidebar.tsx
    src/app/apps/tasks/[projectId]/project-view.tsx
    src/components/tasks/section-header.tsx
    src/app/apps/tasks/search/search-input.tsx
    src/app/apps/tasks/tags/tag-list.tsx
  </files>
  <action>
    Create the help tips feature based on Phase 31 patterns (originally built for todoist). The help tips were not migrated to personal-brand and need to be recreated.

    1. **Create help tips data catalog** (`src/data/help-tips.ts`):
       Create a centralized catalog of help tip text. Define typed tip IDs and a Record mapping:
       ```typescript
       export type HelpTipId =
         | 'quick-add'
         | 'board-view'
         | 'sections'
         | 'search'
         | 'tags'
         | 'effort'
         | 'today-view'
         | 'subtasks';

       export const HELP_TIPS: Record<HelpTipId, { title: string; body: string }> = {
         'quick-add': {
           title: 'Quick Add',
           body: 'Create a task from any page. Choose a project, set a deadline, and assign tags all in one step.'
         },
         'board-view': {
           title: 'Board View',
           body: 'Toggle between list and board (Kanban) view. Board view shows sections as columns with drag-free visual organization.'
         },
         'sections': {
           title: 'Sections',
           body: 'Group related tasks within a project. Each section shows its own effort total.'
         },
         'search': {
           title: 'Search Tasks',
           body: 'Search across all your tasks by name or description. Results update as you type.'
         },
         'tags': {
           title: 'Tags',
           body: 'Organize tasks with colored tags. Click a tag to see all tasks with that label.'
         },
         'effort': {
           title: 'Effort Scoring',
           body: 'Assign effort points (Fibonacci-ish: 1, 2, 3, 5, 8, 13) to estimate task complexity. Totals roll up to sections and projects.'
         },
         'today-view': {
           title: 'Today View',
           body: 'Shows all tasks with a deadline set to today, across all projects.'
         },
         'subtasks': {
           title: 'Subtasks',
           body: 'Break down complex tasks into smaller subtasks. Progress shows as a fraction (e.g., 2/5) on the parent task.'
         },
       };
       ```

    2. **Create viewport-aware tooltip hook** (`src/lib/hooks/use-tooltip-position.ts`):
       Create a custom hook that calculates tooltip position to keep it within viewport bounds:
       ```typescript
       'use client';
       import { useCallback, useState } from 'react';

       interface TooltipPosition {
         top: number;
         left: number;
       }

       export function useTooltipPosition() {
         const [position, setPosition] = useState<TooltipPosition>({ top: 0, left: 0 });

         const updatePosition = useCallback((triggerRect: DOMRect) => {
           const tooltipWidth = 256; // w-64
           const tooltipHeight = 80; // approx
           const gap = 8;

           let top = triggerRect.bottom + gap;
           let left = triggerRect.left + triggerRect.width / 2 - tooltipWidth / 2;

           // Keep within viewport
           if (left < 8) left = 8;
           if (left + tooltipWidth > window.innerWidth - 8) left = window.innerWidth - tooltipWidth - 8;
           if (top + tooltipHeight > window.innerHeight - 8) {
             top = triggerRect.top - tooltipHeight - gap;
           }

           setPosition({ top, left });
         }, []);

         return { position, updatePosition };
       }
       ```

    3. **Create HelpTip component** (`src/components/tasks/ui/help-tip.tsx`):
       Create a client component with toggletip interaction:
       - Gold question mark icon (?) in a small circle
       - Click pins the tooltip open, click again or Escape or click-outside closes
       - Hover opens with 300ms delay (if not already pinned)
       - Tooltip shows title in bold + body text
       - Uses `useTooltipPosition` hook for viewport-aware placement
       - Uses `createPortal` to render tooltip in document.body (avoids overflow clipping)
       - Accessible: role="status", aria-live="polite"

       Props: `tipId: HelpTipId` -- looks up text from the catalog.
       Size: small inline icon (w-4 h-4) that blends with section headers.

    4. **Place HelpTip icons in 5 locations** (add to existing components):
       - **Sidebar**: Next to "Add Task" button label -- `<HelpTip tipId="quick-add" />`
       - **Project view**: Next to the list/board toggle buttons -- `<HelpTip tipId="board-view" />`
       - **Section header**: Next to the section name -- `<HelpTip tipId="sections" />`
       - **Search input**: Next to the "Search" page heading -- `<HelpTip tipId="search" />`
       - **Tag list**: Next to the "Filters & Tags" page heading -- `<HelpTip tipId="tags" />`

       Each placement is a small `<HelpTip tipId="..." />` inline next to the relevant UI element. Only modify the client components (not server page.tsx files). For search-input.tsx and tag-list.tsx, add the HelpTip next to the heading or input area.

    5. **Do NOT place help tips in server components** -- they use hooks and must live in client components only. If the heading is in a server page.tsx, either move the heading into the client component or skip that placement.
  </action>
  <verify>
    - `npm run build` succeeds
    - `npm run lint` passes
    - `ls src/data/help-tips.ts src/lib/hooks/use-tooltip-position.ts src/components/tasks/ui/help-tip.tsx` -- all three files exist
    - Grep confirms HelpTip is imported in at least 3 components
  </verify>
  <done>
    Help tips feature complete with 8-entry centralized catalog, viewport-aware positioning hook, accessible HelpTip component, and 5 placements across sidebar, project view, section headers, search, and tags pages. All help tips display informative tooltips on hover/click.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `npm run build && npm run lint` both pass
2. Today view, Completed view, Search, Quick-add all have complete code chains
3. Help tips catalog has 8 entries, component exists, 5+ placements in UI
4. All service functions exist with proper Prisma relations
</verification>

<success_criteria>
- Build and lint pass cleanly
- Today view code correctly filters by today's deadline
- Completed view code shows completed tasks with project filter
- Search code performs case-insensitive name/description search
- Quick-add modal code creates tasks from sidebar with all fields
- Help tips display on hover/click at 5 locations with informative text
</success_criteria>

<output>
After completion, create `.planning/phases/47-feature-parity-and-demo-mode/47-02-SUMMARY.md`
</output>
