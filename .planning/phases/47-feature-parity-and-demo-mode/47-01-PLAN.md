---
phase: 47-feature-parity-and-demo-mode
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/apps/tasks/[projectId]/page.tsx
  - src/app/apps/tasks/[projectId]/project-view.tsx
  - src/components/tasks/task-card.tsx
  - src/components/tasks/task-form.tsx
  - src/components/tasks/subtask-list.tsx
  - src/components/tasks/board-view.tsx
  - src/components/tasks/section-header.tsx
  - src/components/tasks/add-task-button.tsx
  - src/components/tasks/add-section-button.tsx
  - src/app/apps/tasks/tags/page.tsx
  - src/app/apps/tasks/tags/tag-list.tsx
  - src/app/apps/tasks/tags/[tagId]/page.tsx
autonomous: true
requirements: [FP-01, FP-02, FP-03, FP-04, FP-05]

must_haves:
  truths:
    - "Project detail page at /apps/tasks/[projectId] renders with list view as default"
    - "Board view toggle switches to kanban column layout and persists via server action"
    - "Task CRUD works: create via AddTaskButton, edit via TaskForm, delete via ConfirmDialog, toggle status via checkbox"
    - "Subtasks render below parent task, can be toggled and deleted"
    - "Tags page lists all tags with task counts, tag detail page filters tasks by tag"
  artifacts:
    - path: "src/app/apps/tasks/[projectId]/project-view.tsx"
      provides: "Project view with list/board toggle"
    - path: "src/components/tasks/task-card.tsx"
      provides: "Task card with toggle, edit, delete, subtask expansion"
    - path: "src/components/tasks/board-view.tsx"
      provides: "Kanban board view of sections"
    - path: "src/app/apps/tasks/tags/tag-list.tsx"
      provides: "Tag list with create/delete and navigation to tag detail"
  key_links:
    - from: "src/app/apps/tasks/[projectId]/project-view.tsx"
      to: "@/actions/tasks/project"
      via: "updateProjectViewModeAction"
      pattern: "updateProjectViewModeAction"
    - from: "src/components/tasks/task-card.tsx"
      to: "@/actions/tasks/task"
      via: "toggleTaskAction, deleteTaskAction"
      pattern: "toggleTaskAction|deleteTaskAction"
    - from: "src/app/apps/tasks/tags/tag-list.tsx"
      to: "@/actions/tasks/tag"
      via: "createTagAction, deleteTagAction"
      pattern: "createTagAction|deleteTagAction"
---

<objective>
Verify and fix project detail views (list + board), task CRUD operations (create, edit, delete, toggle), subtask support, and tag management features.

Purpose: Ensure core task management features migrated from the standalone todoist app work identically at /apps/tasks in the personal-brand app.
Output: All project views, task CRUD, subtask operations, and tag management verified working with any integration issues fixed.
</objective>

<execution_context>
@/Users/dweinbeck/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dweinbeck/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/45-ui-components-routing/45-01-SUMMARY.md
@.planning/phases/45-ui-components-routing/45-02-SUMMARY.md
@.planning/phases/44-server-side-code-migration/44-03-SUMMARY.md

Key files to examine:
@src/app/apps/tasks/[projectId]/project-view.tsx
@src/components/tasks/task-card.tsx
@src/components/tasks/task-form.tsx
@src/components/tasks/subtask-list.tsx
@src/components/tasks/board-view.tsx
@src/components/tasks/section-header.tsx
@src/components/tasks/add-task-button.tsx
@src/components/tasks/add-section-button.tsx
@src/app/apps/tasks/tags/tag-list.tsx
@src/actions/tasks/task.ts
@src/actions/tasks/project.ts
@src/actions/tasks/tag.ts
@src/services/tasks/project.service.ts
@src/services/tasks/task.service.ts
@src/services/tasks/tag.service.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify project detail views and task CRUD</name>
  <files>
    src/app/apps/tasks/[projectId]/page.tsx
    src/app/apps/tasks/[projectId]/project-view.tsx
    src/components/tasks/task-card.tsx
    src/components/tasks/task-form.tsx
    src/components/tasks/subtask-list.tsx
    src/components/tasks/board-view.tsx
    src/components/tasks/section-header.tsx
    src/components/tasks/add-task-button.tsx
    src/components/tasks/add-section-button.tsx
  </files>
  <action>
    Systematically verify and fix the core feature parity for project views and task CRUD:

    1. **Build verification**: Run `npm run build` and `npm run lint` to identify any compile-time issues in these files. Fix any TypeScript errors, missing imports, or broken references.

    2. **Import chain audit**: Trace the import chain from each component to its server actions and services:
       - `project-view.tsx` → `@/actions/tasks/project` (updateProjectAction, updateProjectViewModeAction)
       - `task-card.tsx` → `@/actions/tasks/task` (toggleTaskAction, deleteTaskAction)
       - `task-form.tsx` → `@/actions/tasks/task` (createTaskAction, updateTaskAction)
       - `subtask-list.tsx` → `@/actions/tasks/task` (createSubtaskAction, toggleTaskAction, deleteTaskAction)
       - `board-view.tsx` → imports TaskCard, SectionHeader, AddTaskButton
       - `section-header.tsx` → `@/actions/tasks/section` (updateSectionAction, deleteSectionAction)
       - `add-task-button.tsx` → `@/actions/tasks/task` (createTaskAction)
       - `add-section-button.tsx` → `@/actions/tasks/section` (createSectionAction)

    3. **Verify each action exists and is callable**: Read each action file in `src/actions/tasks/` and confirm the exported functions match what components import. Fix any mismatches.

    4. **Verify service layer**: Check that each service function called by actions exists in the corresponding service file. Key functions:
       - `project.service.ts`: getProject, getAllProjects
       - `task.service.ts`: createTask, updateTask, deleteTask, toggleTask, createSubtask
       - `section.service.ts`: createSection, updateSection, deleteSection
       - `tag.service.ts`: getTags, getTasksByTag

    5. **Verify ProjectWithSections type**: The `project-view.tsx` depends on `ProjectWithSections` type from `@/lib/tasks/types.ts`. Confirm it includes `sections` with `tasks` arrays, `viewMode`, and that the Prisma query in `getProject` includes all needed relations (sections.tasks.tags, sections.tasks.subtasks).

    6. **Fix any issues found**:
       - Missing exports → add them
       - Wrong import paths → correct them
       - Missing Prisma includes → add them to service queries
       - Type mismatches → fix type definitions

    7. **Effort scoring display**: Verify `computeEffortSum` from `@/lib/tasks/effort.ts` is imported and used correctly in project-view.tsx for both project-level and section-level effort display. Confirm `task.effort` is included in the Prisma query result.
  </action>
  <verify>
    - `npm run build` succeeds with zero errors
    - `npm run lint` passes (warnings OK)
    - Grep confirms all action imports resolve: `grep -r "from.*@/actions/tasks" src/app/apps/tasks/ src/components/tasks/` shows no unresolved paths
  </verify>
  <done>
    All project detail view components (list + board), task CRUD components (TaskCard, TaskForm, AddTaskButton), subtask components (SubtaskList), and section components (SectionHeader, AddSectionButton) compile without errors, with all imports resolving to existing action and service modules. Effort scoring displays correctly on tasks and in section/project summaries.
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify and fix tag management feature chain</name>
  <files>
    src/app/apps/tasks/tags/page.tsx
    src/app/apps/tasks/tags/tag-list.tsx
    src/app/apps/tasks/tags/[tagId]/page.tsx
    src/actions/tasks/tag.ts
    src/services/tasks/tag.service.ts
  </files>
  <action>
    Verify the complete tag management feature chain works end-to-end:

    1. **Tags list page** (`/apps/tasks/tags`): Verify `tag-list.tsx` imports and calls `createTagAction` and `deleteTagAction` from `@/actions/tasks/tag`. Confirm the tag list renders tag name, color dot, and task count. Verify links navigate to `/apps/tasks/tags/[tagId]`.

    2. **Tag detail page** (`/apps/tasks/tags/[tagId]`): Verify it calls `getTasksByTag(userId, tagId)` from `@/services/tasks/tag.service`. Confirm TaskCard renders for each matching task with full task relations (subtasks, tags).

    3. **Tag CRUD actions**: Read `src/actions/tasks/tag.ts` and verify:
       - `createTagAction(token, formData)` exists with Zod validation
       - `deleteTagAction(token, tagId)` exists
       - Both call `revalidatePath('/apps/tasks')` (not '/tasks')
       - Both verify auth via token

    4. **Tag service**: Read `src/services/tasks/tag.service.ts` and verify:
       - `getTags(userId)` returns tags with `_count.tasks`
       - `getTasksByTag(userId, tagId)` returns tasks with full relations (subtasks, tags)
       - `createTag(userId, data)` and `deleteTag(userId, tagId)` exist

    5. **Tag assignment in TaskForm**: Verify `task-form.tsx` supports tag selection (renders tag chips, toggles selection, passes `tagIds` to createTaskAction/updateTaskAction).

    6. **Fix any issues**: Missing revalidatePath prefix, wrong service function names, missing Prisma includes for tag queries.
  </action>
  <verify>
    - `npm run build` succeeds
    - `npm run lint` passes
    - Tag action files contain `revalidatePath('/apps/tasks')` not `revalidatePath('/tasks')`
  </verify>
  <done>
    Tag management chain is complete: tags list page shows tags with counts, tag detail page filters tasks by tag, tags can be created and deleted via actions, and tasks can be tagged via the task form. All paths use /apps/tasks prefix.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `npm run build && npm run lint` both pass
2. All imports from `@/actions/tasks/*` resolve to existing exports
3. All imports from `@/services/tasks/*` resolve to existing exports
4. All `revalidatePath` calls use `/apps/tasks` prefix
5. No TypeScript errors in modified files
</verification>

<success_criteria>
- Build and lint pass cleanly
- Project detail view code supports both list and board view modes
- Task CRUD (create, edit, delete, toggle) code chains are complete from UI component to server action to service to Prisma
- Subtask support code chain is complete
- Tag management code chain is complete (list, detail, create, delete, assign)
- Effort scoring displays on tasks and in section/project effort summaries
</success_criteria>

<output>
After completion, create `.planning/phases/47-feature-parity-and-demo-mode/47-01-SUMMARY.md`
</output>
