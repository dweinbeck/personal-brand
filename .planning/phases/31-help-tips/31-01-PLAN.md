---
phase: 31-help-tips
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/data/help-tips.ts
  - src/lib/hooks/use-tooltip-position.ts
  - src/components/ui/help-tip.tsx
  - src/data/__tests__/help-tips.test.ts
  - src/components/tasks/sidebar.tsx
  - src/app/tasks/[projectId]/project-view.tsx
  - src/components/tasks/section-header.tsx
  - src/app/tasks/search/search-input.tsx
  - src/app/tasks/tags/tag-list.tsx
autonomous: true

must_haves:
  truths:
    - "User sees a gold '?' icon next to key UI elements (workspaces heading, quick add, board/list toggle, sections, tags, search, filters)"
    - "Hovering or focusing the '?' icon reveals a tooltip with descriptive help text"
    - "User can navigate to help tips via keyboard (Tab to focus opens tip, Escape dismisses)"
    - "Screen reader announces tooltip content via ARIA tooltip role when tip is triggered"
    - "On mobile, tapping the '?' icon toggles the tooltip open and closed"
    - "Tooltips stay within the viewport (flip from top to bottom when near top edge)"
    - "All help tip text lives in src/data/help-tips.ts, not scattered across components"
  artifacts:
    - path: "src/data/help-tips.ts"
      provides: "Centralized tip catalog with typed IDs and string content"
      contains: "helpTips"
    - path: "src/lib/hooks/use-tooltip-position.ts"
      provides: "Viewport-aware placement hook"
      exports: ["useTooltipPosition"]
    - path: "src/components/ui/help-tip.tsx"
      provides: "HelpTip client component with gold icon, tooltip bubble, ARIA attributes"
      exports: ["HelpTip"]
      min_lines: 60
    - path: "src/data/__tests__/help-tips.test.ts"
      provides: "Unit test validating catalog completeness"
      contains: "describe"
  key_links:
    - from: "src/components/ui/help-tip.tsx"
      to: "src/data/help-tips.ts"
      via: "import helpTips and HelpTipId"
      pattern: "import.*helpTips.*from.*@/data/help-tips"
    - from: "src/components/ui/help-tip.tsx"
      to: "src/lib/hooks/use-tooltip-position.ts"
      via: "import useTooltipPosition"
      pattern: "import.*useTooltipPosition.*from.*@/lib/hooks"
    - from: "src/components/tasks/sidebar.tsx"
      to: "src/components/ui/help-tip.tsx"
      via: "import HelpTip"
      pattern: "import.*HelpTip.*from.*@/components/ui/help-tip"
    - from: "src/app/tasks/[projectId]/project-view.tsx"
      to: "src/components/ui/help-tip.tsx"
      via: "import HelpTip"
      pattern: "import.*HelpTip.*from.*@/components/ui/help-tip"
---

<objective>
Build the HelpTip component, centralized tip catalog, viewport-aware positioning hook, and wire help tips into 6-8 key UI locations in the todoist app.

Purpose: Users can discover contextual help for unfamiliar UI elements via accessible gold tooltip icons (TIPS-01 through TIPS-04).
Output: Fully functional help tips across the todoist app with passing lint, build, and unit tests.
</objective>

<execution_context>
@/Users/dweinbeck/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dweinbeck/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/31-help-tips/31-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create help-tip catalog, positioning hook, HelpTip component, and unit test</name>
  <files>
    src/data/help-tips.ts
    src/lib/hooks/use-tooltip-position.ts
    src/components/ui/help-tip.tsx
    src/data/__tests__/help-tips.test.ts
  </files>
  <action>
IMPORTANT: All work happens in the todoist repo at `/Users/dweinbeck/Documents/todoist`.

**1. Create `src/data/help-tips.ts` -- Centralized tip catalog (TIPS-03)**

Define a `HelpTipId` union type and a `helpTips` Record mapping IDs to help text strings. Include these initial tip IDs:

- `"sidebar-workspaces"` -- "Workspaces group your projects. Click + to create one."
- `"sidebar-quick-add"` -- "Quickly add a task to any project without navigating away."
- `"board-view-toggle"` -- "Switch between list and board (Kanban) views for your project."
- `"task-sections"` -- "Sections organize tasks within a project. Drag tasks between sections."
- `"task-tags"` -- "Tags let you categorize tasks across projects. Filter by tag to find related tasks."
- `"task-subtasks"` -- "Break large tasks into smaller subtasks. Check them off independently."
- `"search-tasks"` -- "Search across all tasks by name. Results update as you type."
- `"filters-tags"` -- "Create and manage tags here. Click a tag to see all tasks with that tag."

Export both `HelpTipId` type and `helpTips` record.

**2. Create `src/lib/hooks/use-tooltip-position.ts` -- Viewport-aware placement hook**

Create the `src/lib/hooks/` directory if it does not exist.

Export a `useTooltipPosition` hook that:
- Maintains a `placement` state: `"top" | "bottom"` (default `"top"`).
- Exposes an `updatePlacement(triggerEl: HTMLElement | null)` callback that:
  - Calls `getBoundingClientRect()` on the trigger element.
  - Sets placement to `"bottom"` if `rect.top < 80` (not enough space above).
  - Sets placement to `"top"` otherwise.
- Returns `{ placement, updatePlacement }`.

**3. Create `src/components/ui/help-tip.tsx` -- HelpTip component (TIPS-01, TIPS-02, TIPS-04)**

Mark as `"use client"`.

Props: `{ tipId: HelpTipId; className?: string }`.

Behavior -- toggletip interaction model with tooltip ARIA:
- Render a `<button>` trigger with gold "?" styling: `w-5 h-5 rounded-full bg-gold/20 text-gold hover:bg-gold/30`, centered "?" character, `focus:ring-2 focus:ring-gold/50`.
- Track two states: `open` (boolean) and `pinned` (boolean, for click-to-lock).
- **Click/tap:** Toggle `open` AND `pinned`. If closing via click, also set `pinned = false`.
- **Hover enter (onMouseEnter):** Set `open = true` ONLY if not already `pinned`. Use a ~300ms delay via `setTimeout` before opening (store timeout ref to clear on leave).
- **Hover leave (onMouseLeave):** Set `open = false` ONLY if not `pinned`. Use a ~150ms delay to prevent flicker (clear on re-enter).
- **Focus:** Set `open = true` (immediate, no delay).
- **Blur:** Set `open = false` ONLY if not `pinned`.
- **Escape key:** Set `open = false` AND `pinned = false` (global keydown listener, only when open).
- **Outside click:** Set `open = false` AND `pinned = false` (global click listener with capture, only when open). Check that click target is not inside trigger or tooltip refs.

Tooltip bubble (rendered only when `open` is true):
- Set `id` to a value from `useId()`, reference via `aria-describedby` on the trigger button (only when open).
- Set `role="tooltip"` on the bubble div.
- Use `useTooltipPosition` hook. Call `updatePlacement(triggerRef.current)` on every open transition.
- Apply placement-dependent Tailwind classes:
  - `top`: `bottom-full left-1/2 -translate-x-1/2 mb-2`
  - `bottom`: `top-full left-1/2 -translate-x-1/2 mt-2`
- Style: `z-50 px-3 py-2 text-xs text-white bg-primary rounded-lg shadow-lg max-w-[200px] w-max pointer-events-auto`.
- Render a CSS triangle arrow pointing toward the trigger:
  - `top` placement: arrow at `top-full`, using `border-t-primary border-transparent border-4`
  - `bottom` placement: arrow at `bottom-full`, using `border-b-primary border-transparent border-4`

Wrap everything in `<span className={cn("relative inline-flex items-center", className)}>`.

Import `cn` from `@/lib/utils`, `helpTips` and `HelpTipId` from `@/data/help-tips`, `useTooltipPosition` from `@/lib/hooks/use-tooltip-position`.

**4. Create `src/data/__tests__/help-tips.test.ts` -- Catalog unit test**

Create `src/data/__tests__/` directory if it does not exist.

Write a vitest test suite:
- Test: "every tip ID in the catalog has non-empty string text" -- iterate `Object.entries(helpTips)`, assert each value is a non-empty string.
- Test: "HelpTipId type covers at least 6 tips" -- assert `Object.keys(helpTips).length >= 6`.

Run `npm test` from the todoist directory and confirm all tests pass.
  </action>
  <verify>
Run from `/Users/dweinbeck/Documents/todoist`:
- `npm run lint` passes with no errors
- `npm run build` succeeds
- `npm test` passes (including the new help-tips test)
- Confirm `src/data/help-tips.ts` exports `helpTips` and `HelpTipId`
- Confirm `src/components/ui/help-tip.tsx` has `"use client"`, `role="tooltip"`, `aria-describedby`, Escape handler, outside-click handler
  </verify>
  <done>
HelpTip component renders a gold "?" button that shows a tooltip on click/hover/focus, dismisses on Escape/outside-click/blur, uses viewport-aware positioning, and reads text from a centralized catalog. Unit test validates catalog integrity. Lint, build, and tests all pass.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire HelpTip into sidebar, project view, section header, search, and tags</name>
  <files>
    src/components/tasks/sidebar.tsx
    src/app/tasks/[projectId]/project-view.tsx
    src/components/tasks/section-header.tsx
    src/app/tasks/search/search-input.tsx
    src/app/tasks/tags/tag-list.tsx
  </files>
  <action>
IMPORTANT: All work happens in the todoist repo at `/Users/dweinbeck/Documents/todoist`.

Add `import { HelpTip } from "@/components/ui/help-tip";` to each file below and place the `<HelpTip>` component in the specified location. Use `className="ml-1"` or `className="ml-2"` for spacing as appropriate to maintain visual alignment.

**1. `src/components/tasks/sidebar.tsx`** -- 2 tips

a) **Workspaces heading** (tipId: `"sidebar-workspaces"`):
   - Find the "Workspaces" label `<span>` (around line 188-190).
   - Place `<HelpTip tipId="sidebar-workspaces" className="ml-1" />` immediately after the closing `</span>` of the "Workspaces" text, inside the same `<div className="flex items-center justify-between ...">` container.

b) **Quick Add button** (tipId: `"sidebar-quick-add"`):
   - Find the "Add Task" button in the `px-3 pt-3 pb-1` div (around line 148-166).
   - Add a `<HelpTip tipId="sidebar-quick-add" className="ml-1" />` right after the `</button>` inside that div. Adjust the parent `<div>` to use `flex items-center gap-2` if needed so the help tip sits inline next to the button.

**2. `src/app/tasks/[projectId]/project-view.tsx`** -- 1 tip

a) **Board/list view toggle** (tipId: `"board-view-toggle"`):
   - Find the view toggle container div (around line 68, the `flex items-center gap-1 ml-4 rounded-...` div).
   - Place `<HelpTip tipId="board-view-toggle" className="ml-2" />` immediately after the closing `</div>` of the toggle container, still within the parent `mb-6 flex items-center justify-between` div.

**3. `src/components/tasks/section-header.tsx`** -- 1 tip

a) **Sections concept** (tipId: `"task-sections"`):
   - Find the section name display (the non-editing state, around line 57-66).
   - Place `<HelpTip tipId="task-sections" className="ml-1" />` after the section name button, inside the `flex items-center justify-between` container. Wrap the button and HelpTip in a `<div className="flex items-center">` if needed to keep them inline.

**4. `src/app/tasks/search/search-input.tsx`** -- 1 tip

   - Read the file first to understand its structure.
   - Place `<HelpTip tipId="search-tasks" className="ml-2" />` near the search heading or search input label. If there is a heading/label element, place it inline after the text. If the component is just an input with no heading, add a small wrapper with the help tip next to the search icon or input.

**5. `src/app/tasks/tags/tag-list.tsx`** -- 1 tip

   - Read the file first to understand its structure.
   - Place `<HelpTip tipId="filters-tags" className="ml-2" />` near the "Tags" or "Filters & Tags" heading. If there is a heading element, place it inline after the heading text.

**After wiring all tips:**

Run the full quality gate from `/Users/dweinbeck/Documents/todoist`:
```bash
npm run lint && npm run build && npm test
```

Fix any lint, type, or build errors. Common issues to watch for:
- Biome may flag unused imports if you import HelpTip but misspell the usage.
- The `"use client"` directive is already present in sidebar.tsx, section-header.tsx, and project-view.tsx. For search-input.tsx and tag-list.tsx, check if they already have it -- HelpTip is a client component, so the parent must also be a client component or render it within a client boundary.
- TypeScript should infer types correctly since `tipId` is typed as `HelpTipId`.
  </action>
  <verify>
Run from `/Users/dweinbeck/Documents/todoist`:
- `npm run lint` passes with no errors
- `npm run build` succeeds
- `npm test` passes
- Grep confirms HelpTip is imported and used in all 5 target files:
  - `grep -r "HelpTip" src/components/tasks/sidebar.tsx` shows 2 usages
  - `grep -r "HelpTip" src/app/tasks/*/` shows usages in project-view, search, tags
  - `grep -r "HelpTip" src/components/tasks/section-header.tsx` shows 1 usage
  </verify>
  <done>
HelpTip component is wired into 6 locations across the todoist app: sidebar workspaces heading, sidebar quick-add area, board/list toggle, section headers, search page, and filters/tags page. All tip text comes from the centralized catalog. Lint, build, and tests pass clean.
  </done>
</task>

</tasks>

<verification>
Phase 31 is complete when ALL of the following are true:

1. **TIPS-01**: Gold "?" icons appear next to: workspaces heading, quick-add button, board/list toggle, section headers, search, and filters/tags -- each shows descriptive help text on hover or focus
2. **TIPS-02**: Tab navigates to each "?" icon; focus opens the tip; Escape dismisses it; `role="tooltip"` and `aria-describedby` are present in the DOM when open
3. **TIPS-03**: All help tip text is defined in `src/data/help-tips.ts` -- no help text string appears in any component file
4. **TIPS-04**: On mobile, tapping the "?" toggles the tooltip; tooltip has `max-w-[200px]`; viewport-aware positioning flips to bottom when near the top edge
5. **Quality gates**: `npm run lint`, `npm run build`, and `npm test` all pass in the todoist repo
</verification>

<success_criteria>
- 8 help tips defined in centralized catalog
- HelpTip component supports click/hover/focus triggers, Escape dismiss, outside-click dismiss, pinned state, viewport-aware positioning
- 6 UI locations have HelpTip wired in
- Unit test validates catalog integrity
- All quality gates pass (lint, build, test)
</success_criteria>

<output>
After completion, create `.planning/phases/31-help-tips/31-01-SUMMARY.md`
</output>
