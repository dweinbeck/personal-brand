---
phase: 40.1-testing-feedback-fixes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/envelopes/EnvelopeCard.tsx
  - src/components/envelopes/EnvelopesHomePage.tsx
autonomous: true

must_haves:
  truths:
    - "User can click an edit button on an envelope card while in edit mode to change its budget"
    - "Clicking the edit button shows the existing EnvelopeForm with the current title, budget, and rollover pre-filled"
    - "Saving the edited budget updates the card immediately"
  artifacts:
    - path: "src/components/envelopes/EnvelopeCard.tsx"
      provides: "Edit button alongside delete button in edit mode"
      contains: "onEdit"
    - path: "src/components/envelopes/EnvelopesHomePage.tsx"
      provides: "onEdit handler that sets editingId"
      contains: "setEditingId"
  key_links:
    - from: "src/components/envelopes/EnvelopeCard.tsx"
      to: "src/components/envelopes/EnvelopesHomePage.tsx"
      via: "onEdit callback prop"
      pattern: "onEdit.*setEditingId"
---

<objective>
Add an edit button to EnvelopeCard in edit mode so users can modify an envelope's budget without deleting and re-creating it.

Purpose: Users currently can only delete an envelope card to change its budget, which also deletes all transactions. Adding an edit button lets them modify the budget in-place while preserving data.
Output: EnvelopeCard shows both an edit (pencil) and delete (X) button in edit mode. Clicking edit opens the existing EnvelopeForm with pre-filled values.
</objective>

<execution_context>
@/Users/dweinbeck/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dweinbeck/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/components/envelopes/EnvelopeCard.tsx
@src/components/envelopes/EnvelopesHomePage.tsx
@src/components/envelopes/EnvelopeForm.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add edit button to EnvelopeCard and wire into EnvelopesHomePage</name>
  <files>src/components/envelopes/EnvelopeCard.tsx, src/components/envelopes/EnvelopesHomePage.tsx</files>
  <action>
  In `EnvelopeCard.tsx`:
  1. Add an `onEdit: () => void` prop to `EnvelopeCardProps`
  2. In the edit-mode button area (the absolute-positioned section at top-right), add a pencil/edit icon button BEFORE the existing delete (X) button. The edit button should:
     - Use a pencil SVG icon (same h-6 w-6 rounded-full pattern as the delete button)
     - Use gold/blue styling to distinguish from the red delete: `text-primary hover:bg-gold-light hover:text-primary`
     - Call `onEdit()` on click
     - Include `aria-label="Edit {envelope.title}"`
  3. Position both buttons with a flex row (gap-1) so edit is left, delete is right, both at `absolute top-2 right-2`

  In `EnvelopesHomePage.tsx`:
  1. Pass `onEdit={() => setEditingId(env.id)}` to `<EnvelopeCard>` in the render loop. The `editingId` state and `EnvelopeForm` rendering already exist (lines 311-335). This just needs the EnvelopeCard to trigger entering edit mode.

  The EnvelopeForm already handles edit mode with pre-filled values including title, weeklyBudgetCents, and rollover toggle. No changes needed to EnvelopeForm.
  </action>
  <verify>
  - `npm run lint` passes
  - `npm run build` passes
  - Visually confirm in EnvelopeCard.tsx: edit-mode renders TWO buttons (pencil + X) in a flex container
  - Confirm EnvelopesHomePage passes `onEdit` prop to `EnvelopeCard`
  </verify>
  <done>
  When a user clicks "Edit Cards", each envelope card shows both an edit pencil icon and a delete X icon. Clicking the pencil opens the EnvelopeForm with the envelope's current title, budget, and rollover pre-filled. The user can change the budget and save.
  </done>
</task>

</tasks>

<verification>
- `npm run lint && npm run build && npm test` all pass
- EnvelopeCard in edit mode shows two action buttons (edit + delete)
- Clicking edit transitions to EnvelopeForm with correct initial values
- Saving the form persists the budget change
</verification>

<success_criteria>
Users can edit an envelope's budget without deleting it. The edit button appears in edit mode alongside the existing delete button.
</success_criteria>

<output>
After completion, create `.planning/phases/40.1-testing-feedback-fixes-tasks-tooltips-view-persistence-envelopes-budget-editing-and-detail-page-research-assistant-permissions-crash-billing-duplicate-user/40.1-01-SUMMARY.md`
</output>
