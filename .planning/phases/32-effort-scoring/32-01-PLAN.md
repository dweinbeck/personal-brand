---
phase: 32-effort-scoring
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - /Users/dweinbeck/Documents/todoist/prisma/schema.prisma
  - /Users/dweinbeck/Documents/todoist/src/lib/schemas/task.ts
  - /Users/dweinbeck/Documents/todoist/src/services/task.service.ts
  - /Users/dweinbeck/Documents/todoist/src/actions/task.ts
  - /Users/dweinbeck/Documents/todoist/src/components/tasks/task-form.tsx
  - /Users/dweinbeck/Documents/todoist/src/components/tasks/quick-add-modal.tsx
  - /Users/dweinbeck/Documents/todoist/src/components/tasks/task-card.tsx
autonomous: true

must_haves:
  truths:
    - "User can assign an effort score (1, 2, 3, 5, 8, or 13) to any task during creation"
    - "User can change or clear an effort score when editing a task"
    - "User sees an amber effort badge on scored tasks in list and board views"
    - "Unscored tasks show no effort badge (not 0)"
    - "Effort persists across page refresh"
  artifacts:
    - path: "prisma/schema.prisma"
      provides: "effort Int? field on Task model"
      contains: "effort"
    - path: "src/lib/schemas/task.ts"
      provides: "effort validation in create and update schemas"
      contains: "effort"
    - path: "src/actions/task.ts"
      provides: "effort param in createTaskAction and updateTaskAction"
      contains: "effort"
    - path: "src/components/tasks/task-form.tsx"
      provides: "Effort selector UI with toggle buttons"
      contains: "effort"
    - path: "src/components/tasks/quick-add-modal.tsx"
      provides: "Effort selector UI with toggle buttons"
      contains: "effort"
    - path: "src/components/tasks/task-card.tsx"
      provides: "Effort badge display when task.effort != null"
      contains: "effort"
  key_links:
    - from: "src/components/tasks/task-form.tsx"
      to: "src/actions/task.ts"
      via: "effort passed in createTaskAction/updateTaskAction call"
      pattern: "effort"
    - from: "src/actions/task.ts"
      to: "src/lib/schemas/task.ts"
      via: "Zod schema validation includes effort"
      pattern: "effort.*optional"
    - from: "src/services/task.service.ts"
      to: "prisma/schema.prisma"
      via: "spread operator passes effort to Prisma create/update"
      pattern: "effort"
---

<objective>
Add the effort scoring field to the Task data model and wire it through every layer: Prisma schema, Zod validation, server actions, and React UI (task form, quick-add modal, task card badge).

Purpose: Establishes the effort field end-to-end so users can assign and see effort scores. This is the foundation that Plan 02 builds rollup aggregation on top of.

Output: Tasks can be created/edited with an effort score (1/2/3/5/8/13), scored tasks display an amber badge, unscored tasks display no badge.
</objective>

<execution_context>
@/Users/dweinbeck/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dweinbeck/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/32-effort-scoring/32-RESEARCH.md

Source files (all in /Users/dweinbeck/Documents/todoist/):
@/Users/dweinbeck/Documents/todoist/prisma/schema.prisma
@/Users/dweinbeck/Documents/todoist/src/lib/schemas/task.ts
@/Users/dweinbeck/Documents/todoist/src/services/task.service.ts
@/Users/dweinbeck/Documents/todoist/src/actions/task.ts
@/Users/dweinbeck/Documents/todoist/src/components/tasks/task-form.tsx
@/Users/dweinbeck/Documents/todoist/src/components/tasks/quick-add-modal.tsx
@/Users/dweinbeck/Documents/todoist/src/components/tasks/task-card.tsx
@/Users/dweinbeck/Documents/todoist/src/types/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add effort field to Prisma schema, Zod validation, and server actions</name>
  <files>
    /Users/dweinbeck/Documents/todoist/prisma/schema.prisma
    /Users/dweinbeck/Documents/todoist/src/lib/schemas/task.ts
    /Users/dweinbeck/Documents/todoist/src/services/task.service.ts
    /Users/dweinbeck/Documents/todoist/src/actions/task.ts
  </files>
  <action>
    **All work happens in the todoist repo at `/Users/dweinbeck/Documents/todoist`.**

    1. **Prisma schema** (`prisma/schema.prisma`): Add `effort Int?` to the Task model, placed after `status` and before `order`. No default value -- null means unscored (not 0). This satisfies EFFORT-05.

    2. **Run Prisma commands**: Execute `npm run db:generate` then `npm run db:push` from the todoist directory to regenerate the Prisma client and sync the database. The generated types in `src/generated/prisma/client` will automatically include `effort` on the `Task` type, which means `TaskWithRelations` in `src/types/index.ts` gets it for free (no changes to types/index.ts needed).

    3. **Zod schemas** (`src/lib/schemas/task.ts`): Add an `effort` field to both `createTaskSchema` and `updateTaskSchema`. Use:
       ```typescript
       effort: z.union([
         z.literal(1), z.literal(2), z.literal(3),
         z.literal(5), z.literal(8), z.literal(13),
       ]).nullable().optional(),
       ```
       This constrains to valid Fibonacci-like values while keeping it optional. Existing code that does not pass effort continues to work.

    4. **Server actions** (`src/actions/task.ts`): Add `effort?: number | null;` to the `data` parameter type of both `createTaskAction` and `updateTaskAction`. The Zod parse will validate it. No changes needed to the actual function body since `parsed.data` already passes through to the service.

    5. **Service layer** (`src/services/task.service.ts`): In `createTask()`, add `effort: input.effort ?? null,` to the `data` object in the `prisma.task.create()` call (alongside the existing fields like `name`, `description`, etc.). The `updateTask()` function already uses spread (`...data`) so effort will be included automatically from the parsed data -- no change needed there. Verify this by reading the existing `updateTask` code.
  </action>
  <verify>
    From the todoist directory (`/Users/dweinbeck/Documents/todoist`):
    1. `npm run db:generate` completes without errors
    2. `npm run db:push` completes without errors
    3. `npm run build` completes without type errors (confirms generated Prisma types propagate)
    4. `npm run lint` passes
  </verify>
  <done>
    - `effort Int?` exists on Task model in schema.prisma
    - Both Zod schemas validate effort as 1|2|3|5|8|13|null|undefined
    - Both server actions accept effort in their parameter types
    - createTask service explicitly passes effort to Prisma create
    - Build passes with zero type errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Add effort selector to forms and effort badge to task card</name>
  <files>
    /Users/dweinbeck/Documents/todoist/src/components/tasks/task-form.tsx
    /Users/dweinbeck/Documents/todoist/src/components/tasks/quick-add-modal.tsx
    /Users/dweinbeck/Documents/todoist/src/components/tasks/task-card.tsx
  </files>
  <action>
    **All work happens in the todoist repo at `/Users/dweinbeck/Documents/todoist`.**

    Define `EFFORT_VALUES` inline (or import from a shared constant -- but since `src/lib/effort.ts` is created in Plan 02, define inline for now as `const EFFORT_VALUES = [1, 2, 3, 5, 8, 13] as const;` in each component that needs it). Plan 02 will extract the shared constant and these can be updated to import from there.

    1. **TaskForm** (`src/components/tasks/task-form.tsx`):
       - Add `const EFFORT_VALUES = [1, 2, 3, 5, 8, 13] as const;` at the top of the file (outside the component).
       - Add state: `const [effort, setEffort] = useState<number | null>(task?.effort ?? null);`
       - Add an "Effort" selector section AFTER the tags section (before the button row). Use a labeled row of toggle buttons following the exact same visual pattern as the tag buttons (lines 139-161 of the current file):
         ```
         <div className="mt-3">
           <span className="text-xs font-medium text-text-secondary mb-1.5 block">Effort</span>
           <div className="flex flex-wrap gap-1.5">
             {EFFORT_VALUES.map((value) => (
               <button
                 key={value}
                 type="button"
                 onClick={() => setEffort(effort === value ? null : value)}
                 className={cn(
                   "px-2.5 py-1 text-xs rounded-full border transition-colors cursor-pointer",
                   effort === value
                     ? "bg-gold-light border-gold text-primary font-medium"
                     : "border-border text-text-tertiary hover:border-gold hover:text-text-primary"
                 )}
               >
                 {value}
               </button>
             ))}
           </div>
         </div>
         ```
       - Import `cn` from `@/lib/utils` (it may already be imported -- check first).
       - Pass `effort` to both `createTaskAction` and `updateTaskAction` calls in `handleSubmit`. Add `effort,` to both action call objects.

    2. **QuickAddModal** (`src/components/tasks/quick-add-modal.tsx`):
       - Same pattern as TaskForm: add `EFFORT_VALUES` const, `effort` state (initialized to `null`), effort selector UI after tags section.
       - Pass `effort` to `createTaskAction` call.
       - Reset effort in `handleClose`: add `setEffort(null);` alongside the other resets.
       - Import `cn` from `@/lib/utils`.

    3. **TaskCard** (`src/components/tasks/task-card.tsx`):
       - Add an effort badge in the metadata row (the `flex items-center gap-2 mt-1.5 flex-wrap` div, after the deadline and before the tags). Only render when `task.effort != null`:
         ```
         {task.effort != null && (
           <span className="text-xs font-medium text-amber px-1.5 py-0.5 rounded-full bg-amber/10 border border-amber/20">
             {task.effort}
           </span>
         )}
         ```
       - This satisfies EFFORT-02 (visual badge) and EFFORT-05 (no badge when unscored).
  </action>
  <verify>
    From the todoist directory:
    1. `npm run build` passes with zero errors
    2. `npm run lint` passes
    3. Run `npm run dev` and manually verify:
       - Creating a task with effort=5 shows the amber "5" badge on the card
       - Creating a task without effort shows no effort badge
       - Editing a task to change effort persists after save
       - Quick-add modal shows effort selector and passes it through
  </verify>
  <done>
    - TaskForm shows effort selector buttons (1,2,3,5,8,13) with gold highlight on selection
    - QuickAddModal shows effort selector buttons with same pattern
    - Clicking an already-selected effort value clears it (toggles to null)
    - TaskCard shows amber effort badge only when task.effort is not null
    - Unscored tasks show no effort badge at all (satisfies EFFORT-05)
    - Effort value persists through create and edit flows
  </done>
</task>

</tasks>

<verification>
End-to-end flow check:
1. Create a task with effort=8 via TaskForm -> badge shows "8" on the card
2. Edit that task and change effort to 3 -> badge updates to "3"
3. Edit that task and clear effort (click "3" again to deselect) -> badge disappears
4. Create a task via QuickAddModal with effort=13 -> badge shows "13"
5. Create a task with no effort selected -> no badge visible (not "0", not "null")
6. Refresh page -> effort values persist
7. `npm run build && npm run lint` both pass
</verification>

<success_criteria>
- Effort field exists in database schema as optional integer
- All 6 Fibonacci values (1,2,3,5,8,13) are valid; null means unscored
- Both task forms (full form + quick-add) have effort selector UI
- Task cards display effort badge only when scored
- Build and lint pass with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/32-effort-scoring/32-01-SUMMARY.md`
</output>
