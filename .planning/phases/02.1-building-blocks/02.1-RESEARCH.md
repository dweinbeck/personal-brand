# Phase 2.1: Building Blocks - Research

**Researched:** 2026-02-02
**Domain:** Next.js 16 MDX-based tutorial/guide content system with static generation
**Confidence:** HIGH

## Summary

This phase adds a "Building Blocks" section to the site -- a collection of practical, step-by-step tutorials starting with "Setting up a repo for a new project." The core technical challenge is implementing a content system that supports rich tutorial content (code blocks with syntax highlighting, step-by-step instructions, images) while maintaining the existing SSG-first approach.

The standard approach for local MDX content in Next.js 16 App Router is `@next/mdx` (the official package, version 16.1.6 matching the project's Next.js version). Tutorials live as `.mdx` files in a `content/building-blocks/` directory, rendered via dynamic `[slug]` routes with `generateStaticParams` for static generation. `@tailwindcss/typography` (v0.5.19, compatible with Tailwind v4) provides the `prose` class for beautiful typographic defaults on rendered MDX content. Navigation needs a "Building Blocks" link added to the existing `NavLinks` component.

The design inspiration (connorbutch.com -- "Interactive CS Demos") suggests a clean, minimal layout with featured tutorial cards. The listing page should display tutorial cards with title, description, and category/topic tags. Individual tutorial pages should be long-form prose content with clear heading hierarchy, code blocks, and step numbering.

**Primary recommendation:** Use `@next/mdx` with `@tailwindcss/typography` for prose styling. Keep tutorials as local `.mdx` files with exported metadata objects. Use dynamic `[slug]` routes with `generateStaticParams` for SSG.

## Standard Stack

### Core (new packages needed)
| Library | Version | Purpose | Why Standard |
|---------|---------|---------|--------------|
| @next/mdx | 16.1.6 | MDX compilation for Next.js | Official Next.js MDX integration, version-matched to project |
| @mdx-js/loader | 3.1.1 | MDX webpack loader | Required peer dependency of @next/mdx |
| @mdx-js/react | 3.1.1 | MDX React provider | Required peer dependency of @next/mdx |
| @types/mdx | latest | TypeScript types for MDX | Type safety for MDX imports |
| @tailwindcss/typography | 0.5.19 | Prose styling for rendered content | Provides beautiful defaults for long-form content; supports Tailwind v4 |

### Supporting (optional, recommended)
| Library | Version | Purpose | When to Use |
|---------|---------|---------|-------------|
| remark-gfm | 4.0.1 | GitHub Flavored Markdown | Tables, strikethrough, task lists in tutorials |
| rehype-pretty-code | 0.14.1 | Syntax highlighting in code blocks | Tutorial code examples need syntax highlighting |
| shiki | 3.22.0 | Syntax highlighting engine | Used by rehype-pretty-code for highlighting |

### Alternatives Considered
| Instead of | Could Use | Tradeoff |
|------------|-----------|----------|
| @next/mdx | next-mdx-remote-client | next-mdx-remote is for remote content; overkill for local files, less stable with RSC |
| @next/mdx | Plain markdown + gray-matter + unified | More manual setup; loses ability to embed React components in tutorials |
| @tailwindcss/typography | Custom prose CSS | Reinventing well-tested typographic defaults; hundreds of edge cases |
| rehype-pretty-code | prism.js | rehype-pretty-code is newer, tree-shakeable, server-rendered; no client JS |

**Installation:**
```bash
npm install @next/mdx @mdx-js/loader @mdx-js/react @types/mdx @tailwindcss/typography remark-gfm rehype-pretty-code shiki
```

## Architecture Patterns

### Recommended Project Structure
```
src/
├── app/
│   ├── building-blocks/
│   │   ├── page.tsx              # Listing page: all tutorials as cards
│   │   └── [slug]/
│   │       └── page.tsx          # Individual tutorial page (dynamic route)
│   └── ...
├── components/
│   ├── layout/                   # Navbar, Footer (existing)
│   └── building-blocks/          # New: tutorial-specific components
│       └── TutorialCard.tsx      # Card for listing page
├── content/
│   └── building-blocks/          # MDX tutorial files
│       └── setting-up-a-repo.mdx # First tutorial
├── lib/
│   └── tutorials.ts              # Helper: read tutorial metadata from filesystem
mdx-components.tsx                # Root-level MDX component overrides (REQUIRED by @next/mdx)
```

### Pattern 1: MDX with Exported Metadata (No Frontmatter)
**What:** `@next/mdx` does not support frontmatter natively. Instead, each MDX file exports a `metadata` object as a JavaScript const.
**When to use:** Always with `@next/mdx`.
**Example:**
```mdx
// content/building-blocks/setting-up-a-repo.mdx
export const metadata = {
  title: "Setting up a repo for a new project",
  description: "A step-by-step guide to initializing a repository with Git, a proper .gitignore, README, and license.",
  publishedAt: "2026-02-02",
  tags: ["git", "tooling", "beginner"],
};

# Setting up a repo for a new project

Every project starts with a repository. Here is how to set one up properly...
```

### Pattern 2: Dynamic Route with generateStaticParams for SSG
**What:** Use `[slug]` route segment with dynamic import of MDX files. `generateStaticParams` pre-renders all tutorials at build time.
**When to use:** Always -- this is the core routing pattern.
**Example:**
```typescript
// src/app/building-blocks/[slug]/page.tsx
// Source: Next.js official MDX guide + Next.js 16 async params
import { notFound } from "next/navigation";
import { getAllTutorials } from "@/lib/tutorials";

export default async function TutorialPage({
  params,
}: {
  params: Promise<{ slug: string }>;
}) {
  const { slug } = await params;

  try {
    const { default: Content, metadata } = await import(
      `@/content/building-blocks/${slug}.mdx`
    );

    return (
      <article className="mx-auto max-w-3xl px-4 sm:px-6 lg:px-8 py-16">
        <header className="mb-8">
          <h1 className="text-3xl font-bold text-gray-900">{metadata.title}</h1>
          <p className="mt-2 text-gray-600">{metadata.description}</p>
        </header>
        <div className="prose prose-gray max-w-none">
          <Content />
        </div>
      </article>
    );
  } catch {
    return notFound();
  }
}

export async function generateStaticParams() {
  const tutorials = await getAllTutorials();
  return tutorials.map((t) => ({ slug: t.slug }));
}

export const dynamicParams = false;
```

### Pattern 3: Filesystem-Based Tutorial Index
**What:** Read the `content/building-blocks/` directory to build the tutorial listing. Extract metadata from each MDX file via dynamic import.
**When to use:** For the listing page and for `generateStaticParams`.
**Example:**
```typescript
// src/lib/tutorials.ts
import fs from "node:fs";
import path from "node:path";

export interface TutorialMeta {
  title: string;
  description: string;
  publishedAt: string;
  tags: string[];
}

export interface Tutorial {
  slug: string;
  metadata: TutorialMeta;
}

export async function getAllTutorials(): Promise<Tutorial[]> {
  const dir = path.join(process.cwd(), "content", "building-blocks");
  const files = fs.readdirSync(dir).filter((f) => f.endsWith(".mdx"));

  const tutorials = await Promise.all(
    files.map(async (filename) => {
      const slug = filename.replace(/\.mdx$/, "");
      const { metadata } = await import(
        `@/content/building-blocks/${slug}.mdx`
      );
      return { slug, metadata } as Tutorial;
    }),
  );

  // Sort by publishedAt descending
  return tutorials.sort(
    (a, b) =>
      new Date(b.metadata.publishedAt).getTime() -
      new Date(a.metadata.publishedAt).getTime(),
  );
}
```

### Pattern 4: Tutorial Listing Page with Cards
**What:** Server component that displays all tutorials as clickable cards.
**When to use:** The `/building-blocks` index page.
**Example:**
```typescript
// src/app/building-blocks/page.tsx
import Link from "next/link";
import { getAllTutorials } from "@/lib/tutorials";

export default async function BuildingBlocksPage() {
  const tutorials = await getAllTutorials();

  return (
    <div className="mx-auto max-w-5xl px-4 sm:px-6 lg:px-8 py-16">
      <h1 className="text-3xl font-bold text-gray-900">Building Blocks</h1>
      <p className="mt-2 text-gray-600">
        Practical, step-by-step tutorials on common development tasks.
      </p>
      <div className="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
        {tutorials.map((tutorial) => (
          <Link
            key={tutorial.slug}
            href={`/building-blocks/${tutorial.slug}`}
            className="block rounded-lg border border-gray-200 p-6 transition-all duration-200 hover:shadow-md hover:border-gray-300 motion-safe:hover:-translate-y-0.5"
          >
            <h2 className="font-semibold text-gray-900">
              {tutorial.metadata.title}
            </h2>
            <p className="mt-2 text-sm text-gray-600">
              {tutorial.metadata.description}
            </p>
            <div className="mt-4 flex flex-wrap gap-2">
              {tutorial.metadata.tags.map((tag) => (
                <span
                  key={tag}
                  className="inline-block rounded-full bg-gray-100 px-2.5 py-0.5 text-xs font-medium text-gray-600"
                >
                  {tag}
                </span>
              ))}
            </div>
          </Link>
        ))}
      </div>
    </div>
  );
}
```

### Pattern 5: Navigation Update
**What:** Add "Building Blocks" to the existing NavLinks component's `links` array.
**When to use:** Immediately -- this is a navigation addition.
**Example:**
```typescript
// In src/components/layout/NavLinks.tsx, update the links array:
const links = [
  { name: "Home", href: "/" },
  { name: "Projects", href: "/projects" },
  { name: "Building Blocks", href: "/building-blocks" },
  { name: "Writing", href: "/writing" },
  { name: "Assistant", href: "/assistant" },
  { name: "Contact", href: "/contact" },
];
```
Note: The existing `isActive` function uses `pathname.startsWith(href)` for non-root routes, so `/building-blocks/setting-up-a-repo` will correctly highlight the "Building Blocks" nav item.

### Anti-Patterns to Avoid
- **Using next-mdx-remote for local files:** `@next/mdx` is the official, simpler solution for local MDX. next-mdx-remote adds complexity and instability with RSC.
- **Using frontmatter with @next/mdx:** `@next/mdx` does not support frontmatter. Use exported `metadata` objects instead.
- **Dynamic imports in lib/ files:** MDX dynamic imports (`await import()`) must be in route files (page.tsx), not extracted to `src/lib/`. They fail with "Module not found" when moved outside the app directory. The `getAllTutorials` helper should import metadata only, or use `fs` + regex extraction as a fallback.
- **"use client" on tutorial pages:** Tutorial content is static. Keep everything as server components.
- **Putting content/ inside src/:** The `content/` directory should be at the project root, not inside `src/`. The `@/*` path alias maps to `./src/*`, so `@/content/` would need the content dir inside src, OR use a separate alias. Given the tsconfig has `@/*` -> `./src/*`, either place content inside `src/content/` to use `@/content/` imports, or add a new path alias. Placing it at `src/content/` is simpler and avoids tsconfig changes.

## Don't Hand-Roll

| Problem | Don't Build | Use Instead | Why |
|---------|-------------|-------------|-----|
| Prose/typography styling | Custom CSS for headings, lists, code blocks, blockquotes | `@tailwindcss/typography` (`prose` class) | Handles hundreds of edge cases (nested lists, table styling, inline code, blockquotes) |
| Markdown to HTML | Custom remark/rehype pipeline | `@next/mdx` | Handles compilation, caching, HMR, server component rendering |
| Syntax highlighting | Custom Prism/Highlight.js setup | `rehype-pretty-code` + `shiki` | Server-rendered, zero client JS, supports all languages |
| Content metadata system | Custom YAML/JSON metadata files | MDX exported `metadata` objects | Co-located with content, type-safe, imported directly |
| Static route generation | Manual route list | `generateStaticParams` + `fs.readdirSync` | Automatically discovers content files |

**Key insight:** The MDX ecosystem in Next.js 16 is mature. Every piece of the content pipeline (compilation, routing, styling, highlighting) has a standard solution. The only custom code needed is the thin `getAllTutorials()` helper and the page components.

## Common Pitfalls

### Pitfall 1: Missing mdx-components.tsx at Project Root
**What goes wrong:** `@next/mdx` silently fails or throws cryptic errors without a root-level `mdx-components.tsx` file.
**Why it happens:** This file is required by the App Router MDX integration but easy to forget.
**How to avoid:** Create `mdx-components.tsx` at the project root (next to `package.json`) as the first step of MDX setup.
**Warning signs:** MDX pages render as blank or throw "Cannot find module" errors.

### Pitfall 2: Dynamic Import Path Must Be in page.tsx
**What goes wrong:** Moving `await import('@/content/building-blocks/${slug}.mdx')` into a utility function in `src/lib/` causes "Module not found" errors.
**Why it happens:** Next.js webpack resolves dynamic imports relative to the file they appear in. When in `src/lib/`, the content directory is not in the expected resolution path.
**How to avoid:** Keep the `await import()` call directly in `page.tsx`. The `getAllTutorials()` helper can read filenames via `fs` but should not dynamically import MDX.
**Warning signs:** Build errors referencing unresolvable module paths.

### Pitfall 3: Forgetting pageExtensions in next.config
**What goes wrong:** MDX files are not recognized as valid pages/modules.
**Why it happens:** By default, Next.js only processes `.js`, `.jsx`, `.ts`, `.tsx` files.
**How to avoid:** Add `pageExtensions: ['js', 'jsx', 'md', 'mdx', 'ts', 'tsx']` to next.config.ts when setting up `@next/mdx`.
**Warning signs:** 404 errors on MDX pages, or imports failing.

### Pitfall 4: Next.js 16 Async Params
**What goes wrong:** Destructuring `params` directly causes type errors or runtime issues.
**Why it happens:** In Next.js 15+, route params are Promises that must be awaited.
**How to avoid:** Type params as `Promise<{ slug: string }>` and `await params` before using.
**Warning signs:** TypeScript errors about `slug` not existing on Promise type.

### Pitfall 5: Too Many Nav Items on Mobile
**What goes wrong:** Adding "Building Blocks" brings the nav to 6 items. On mobile, the hamburger menu accommodates this, but on smaller desktop screens the horizontal nav may wrap awkwardly.
**Why it happens:** The desktop nav uses `gap-1` with 6 items, each with `px-3` padding.
**How to avoid:** Test at 768px (the `md:` breakpoint where desktop nav appears). If items wrap, reduce `px-3` to `px-2` or shorten "Building Blocks" to "Blocks" on desktop.
**Warning signs:** Nav items wrapping to a second line at `md` breakpoint.

### Pitfall 6: Tailwind Typography Plugin v4 Setup
**What goes wrong:** Using the old `require()` plugin registration from Tailwind v3 in `tailwind.config.js`.
**Why it happens:** Most tutorials show the v3 setup pattern.
**How to avoid:** In Tailwind v4 (CSS-first config), add `@plugin "@tailwindcss/typography";` to your CSS file, not to a config file.
**Warning signs:** `prose` class has no effect on content styling.

## Code Examples

### next.config.ts with MDX Support
```typescript
// Source: Next.js official MDX guide
import createMDX from "@next/mdx";
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  pageExtensions: ["js", "jsx", "md", "mdx", "ts", "tsx"],
  images: {
    qualities: [25, 50, 75, 100],
  },
};

const withMDX = createMDX({
  options: {
    remarkPlugins: [],
    rehypePlugins: [],
  },
});

export default withMDX(nextConfig);
```

### mdx-components.tsx (Required Root File)
```typescript
// Source: Next.js official MDX guide
import type { MDXComponents } from "mdx/types";

export function useMDXComponents(
  components: MDXComponents = {},
): MDXComponents {
  return {
    ...components,
  };
}
```

### Tailwind v4 Typography Plugin Setup
```css
/* In globals.css */
@import "tailwindcss";
@plugin "@tailwindcss/typography";

/* existing @theme blocks... */
```

### Tutorial MDX File Example
```mdx
// content/building-blocks/setting-up-a-repo.mdx (NOTE: if placed at src/content/)

export const metadata = {
  title: "Setting up a repo for a new project",
  description: "Initialize a Git repository with proper structure, .gitignore, README, and license.",
  publishedAt: "2026-02-02",
  tags: ["git", "tooling", "beginner"],
};

# Setting up a repo for a new project

Every project starts with a well-organized repository. This guide walks you through
setting one up from scratch.

## Step 1: Create the directory

Open your terminal and create a new project folder:

\`\`\`bash
mkdir my-new-project
cd my-new-project
\`\`\`

## Step 2: Initialize Git

\`\`\`bash
git init
\`\`\`

This creates a `.git` directory...
```

## State of the Art

| Old Approach | Current Approach | When Changed | Impact |
|--------------|------------------|--------------|--------|
| next-mdx-remote for all MDX | @next/mdx for local, next-mdx-remote-client for remote | 2024-2025 | Simpler setup for local MDX files |
| Frontmatter (gray-matter) | Exported metadata objects | @next/mdx pattern | No additional parsing dependency needed |
| Tailwind Typography via tailwind.config.js | `@plugin` directive in CSS | Tailwind v4 | CSS-first configuration |
| params as plain object | params as Promise (async) | Next.js 15+ | Must await params in dynamic routes |
| Contentlayer for typed content | Direct MDX imports + TypeScript interfaces | Contentlayer unmaintained (2024) | Fewer dependencies, simpler setup |

**Deprecated/outdated:**
- `next-mdx-remote` (hashicorp): Poorly maintained, use `next-mdx-remote-client` if remote content needed
- Contentlayer: Unmaintained since 2024, do not adopt
- `priority` prop on next/image: Use `preload` (Next.js 16)

## Open Questions

1. **Dynamic import of MDX from lib/ helper**
   - What we know: The official docs show dynamic imports in page.tsx. Community reports that moving imports to lib/ causes module resolution failures.
   - What's unclear: Whether this limitation still exists in Next.js 16.1.6 or was fixed.
   - Recommendation: Keep dynamic import in page.tsx. Use `fs.readdirSync` in the helper to list slugs, and a separate regex-based metadata extractor if needed. Test during implementation.

2. **rehype-pretty-code + Turbopack compatibility**
   - What we know: Turbopack requires remark/rehype plugins to be specified as strings, not function references. rehype-pretty-code may need special handling.
   - What's unclear: Whether rehype-pretty-code works as a string plugin reference with Turbopack.
   - Recommendation: Configure plugins as function references initially (webpack mode). If Turbopack is needed, test string-based configuration or switch to `dev --webpack`.

3. **Content directory location**
   - What we know: The `@/*` alias maps to `./src/*`. For `@/content/` imports to work, content must be inside `src/`.
   - What's unclear: Whether placing content inside `src/` is considered an anti-pattern.
   - Recommendation: Place content at `src/content/building-blocks/` to use existing `@/` alias without tsconfig changes. This is a pragmatic choice.

## Sources

### Primary (HIGH confidence)
- [Next.js official MDX guide](https://nextjs.org/docs/app/guides/mdx) - @next/mdx setup, file routing, custom components, generateStaticParams
- [Next.js generateStaticParams docs](https://nextjs.org/docs/app/api-reference/functions/generate-static-params) - SSG with dynamic routes
- npm registry: @next/mdx@16.1.6, @mdx-js/loader@3.1.1, @mdx-js/react@3.1.1 - version verification
- npm registry: @tailwindcss/typography@0.5.19 - Tailwind v4 compatibility confirmed via peerDependencies

### Secondary (MEDIUM confidence)
- [MDX Blog with Next.js 16](https://www.mdxblog.io/code/building-a-modern-blog-with-mdx-and-nextjs-16) - Next.js 16 specific patterns, async params, metadata extraction
- [Tailwind CSS v4 typography plugin setup](https://github.com/tailwindlabs/tailwindcss/discussions/15904) - @plugin directive for v4
- [next-mdx-remote limitations](https://www.mdxblog.io/blog/next-mdx-remote-limitations) - why @next/mdx is preferred for local content

### Tertiary (LOW confidence)
- [GitHub discussion: dynamic imports of MDX](https://github.com/vercel/next.js/discussions/82837) - lib/ vs page.tsx import limitation
- connorbutch.com - could not fetch detailed design content; used general "clean minimal tutorial cards" interpretation

## Metadata

**Confidence breakdown:**
- Standard stack: HIGH - @next/mdx is the official solution, version-matched; @tailwindcss/typography confirmed v4 compatible via peerDependencies
- Architecture: HIGH - patterns follow official Next.js MDX guide and established App Router conventions
- Pitfalls: HIGH - most sourced from official docs; dynamic import limitation confirmed by multiple community reports
- Content structure: MEDIUM - MDX exported metadata pattern is documented but the filesystem helper approach has the lib/ import caveat

**Research date:** 2026-02-02
**Valid until:** 2026-03-04 (stable stack, well-established patterns)
