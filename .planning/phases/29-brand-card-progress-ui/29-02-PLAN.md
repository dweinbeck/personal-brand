---
phase: 29-brand-card-progress-ui
plan: 02
type: execute
wave: 2
depends_on: ["29-01"]
files_modified:
  - src/components/tools/brand-scraper/ScrapeProgressPanel.tsx
  - src/components/tools/brand-scraper/BrandCardHeader.tsx
  - src/components/tools/brand-scraper/BrandCardLogos.tsx
  - src/components/tools/brand-scraper/BrandCardColors.tsx
  - src/components/tools/brand-scraper/BrandCardDescription.tsx
  - src/components/tools/brand-scraper/BrandCardDownloads.tsx
autonomous: true

must_haves:
  truths:
    - "ScrapeProgressPanel shows a list of pages with in-progress/done/failed status derived from pipeline events"
    - "ScrapeProgressPanel shows a list of saved files derived from asset_saved events"
    - "BrandCardHeader renders a fake browser tab bar with traffic-light dots, favicon, and hostname"
    - "BrandCardLogos renders logo images from the taxonomy assets.logos array"
    - "BrandCardColors renders color swatches with hex values from the color.palette array"
    - "BrandCardDescription renders text in the extracted font (best-effort) using useGoogleFont"
    - "BrandCardDownloads renders 'Download Brand JSON File' and 'Download Assets' buttons"
  artifacts:
    - path: "src/components/tools/brand-scraper/ScrapeProgressPanel.tsx"
      provides: "Live progress panel showing pages and files during scrape"
      exports: ["ScrapeProgressPanel"]
    - path: "src/components/tools/brand-scraper/BrandCardHeader.tsx"
      provides: "Browser-tab header with favicon and hostname"
      exports: ["BrandCardHeader"]
    - path: "src/components/tools/brand-scraper/BrandCardLogos.tsx"
      provides: "Logos section for Brand Card"
      exports: ["BrandCardLogos"]
    - path: "src/components/tools/brand-scraper/BrandCardColors.tsx"
      provides: "Color palette swatches section"
      exports: ["BrandCardColors"]
    - path: "src/components/tools/brand-scraper/BrandCardDescription.tsx"
      provides: "Description area rendered in extracted font"
      exports: ["BrandCardDescription"]
    - path: "src/components/tools/brand-scraper/BrandCardDownloads.tsx"
      provides: "Download buttons for JSON and ZIP"
      exports: ["BrandCardDownloads"]
  key_links:
    - from: "src/components/tools/brand-scraper/ScrapeProgressPanel.tsx"
      to: "PipelineMeta type from types.ts"
      via: "events prop typed as ProgressEvent[]"
      pattern: "ProgressEvent"
    - from: "src/components/tools/brand-scraper/BrandCardDescription.tsx"
      to: "src/lib/brand-scraper/fonts.ts"
      via: "useGoogleFont hook for dynamic font loading"
      pattern: "useGoogleFont"
    - from: "src/components/tools/brand-scraper/BrandCardDownloads.tsx"
      to: "/api/tools/brand-scraper/jobs/[id]/assets/zip"
      via: "fetch POST for on-demand zip creation"
      pattern: "assets/zip"
---

<objective>
Create all leaf UI components for the progress panel and Brand Card sections.

Purpose: Phase 29 needs 6 new presentational components: a progress panel showing live scrape activity, and 5 Brand Card section components (header, logos, colors, description, downloads). These are the building blocks that Plan 03 will compose into the full Brand Card and wire into the user-facing page.

Output: 6 new component files in `src/components/tools/brand-scraper/`.
</objective>

<execution_context>
@/Users/dweinbeck/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dweinbeck/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/29-brand-card-progress-ui/29-RESEARCH.md
@.planning/phases/29-brand-card-progress-ui/29-01-SUMMARY.md
@src/lib/brand-scraper/types.ts
@src/lib/brand-scraper/fonts.ts
@src/components/admin/brand-scraper/ColorPaletteCard.tsx
@src/components/admin/brand-scraper/LogoAssetsCard.tsx
@src/components/ui/Button.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ScrapeProgressPanel component</name>
  <files>src/components/tools/brand-scraper/ScrapeProgressPanel.tsx</files>
  <action>
Create `src/components/tools/brand-scraper/ScrapeProgressPanel.tsx` as a `"use client"` component.

**Props:**
```typescript
type ScrapeProgressPanelProps = {
  events: ProgressEvent[];  // from types.ts
};
```

Import `ProgressEvent` type from `@/lib/brand-scraper/types`.

**Logic — derive two lists from the events array:**

1. **Pages being scraped** — derived from `page_started` and `page_done` events:
   - Build a Map keyed by `event.detail.url` (cast as string)
   - `page_started` sets status to "scraping"
   - `page_done` sets status to "done" (or "failed" if `event.detail.failed` is truthy)
   - Extract `isHomepage` from detail for display
   - Each page entry: `{ url: string, status: "scraping" | "done" | "failed", isHomepage: boolean }`

2. **Files saved** — derived from `asset_saved` events:
   - Map each event to `{ filename: event.detail.filename, sizeBytes: event.detail.sizeBytes }`
   - Cast detail fields as string/number with fallbacks

**Rendering:**

Two sections with headings "Pages being scraped" and "Files saved":

- **Pages section**: unordered list. Each page shows:
  - A status indicator: spinning dot or pulse animation for "scraping", green check for "done", red X for "failed"
  - The URL truncated to hostname + path (use `new URL(url)` to parse, show `pathname` portion truncated)
  - "(homepage)" badge if isHomepage is true

- **Files section**: unordered list. Each file shows:
  - A file icon (use a simple SVG or unicode character)
  - The filename (from `detail.filename`, e.g., "logos/primary.svg")
  - File size formatted as KB (sizeBytes / 1024, 1 decimal)

If events array is empty, show a subtle "Waiting for progress data..." message.

**Styling:** Use project palette (navy/gold). Tailwind classes consistent with the rest of the brand-scraper UI. The panel should have a border and subtle background, like `rounded-xl border border-border bg-surface p-4`.

Target: ~80-120 lines.
  </action>
  <verify>
Run `npx tsc --noEmit` — zero type errors. Run `npm run lint` — clean. Verify the file exports `ScrapeProgressPanel`.
  </verify>
  <done>ScrapeProgressPanel derives page progress and saved files from pipeline events and renders them as live-updating lists with status indicators.</done>
</task>

<task type="auto">
  <name>Task 2: Create Brand Card section components</name>
  <files>
    src/components/tools/brand-scraper/BrandCardHeader.tsx
    src/components/tools/brand-scraper/BrandCardLogos.tsx
    src/components/tools/brand-scraper/BrandCardColors.tsx
    src/components/tools/brand-scraper/BrandCardDescription.tsx
    src/components/tools/brand-scraper/BrandCardDownloads.tsx
  </files>
  <action>
Create 5 component files. All should have `"use client"` directive.

### BrandCardHeader.tsx (~40 lines)

**Props:** `{ favicon?: string; hostname: string }`

Renders a fake browser tab bar at the top of the Brand Card (CARD-02):
- Left side: three traffic-light dots (red, amber, green) — `w-3 h-3 rounded-full` with `bg-red-400`, `bg-amber-400`, `bg-emerald-400`
- After dots: a "tab" containing:
  - Favicon image (if provided) — `w-4 h-4` with `<img>` tag (add biome-ignore for img element, same as LogoAssetsCard pattern). Fall back to a simple globe SVG inline if no favicon.
  - Hostname text — `text-sm text-text-secondary truncate`
- Background: `bg-gray-100 dark:bg-gray-800` with bottom border
- Tab shape: `bg-white rounded-t-lg border border-b-0 border-border px-3 py-1`

### BrandCardLogos.tsx (~50 lines)

**Props:** `{ logos?: ExtractedField<AssetEntry>[] }` where AssetEntry is the inferred type of `assetEntrySchema`. Import `type BrandTaxonomy` from types and reference `BrandTaxonomy["assets"]` for the logos type, same pattern as existing `LogoAssetsCard`.

Actually, to keep it simple: **Props:** `{ logos: BrandTaxonomy["assets"] }` — access `logos?.logos` internally.

Renders a horizontal row of logo images (CARD-03):
- Section heading "Logos" (text-sm font-semibold)
- Flexbox row wrapping, gap-4
- Each logo: bordered container with `<img>` tag (biome-ignore for img), `max-h-16 object-contain`
- If no logos, show "No logos detected" in tertiary text
- Similar style to existing LogoAssetsCard but horizontal layout instead of grid

### BrandCardColors.tsx (~60 lines)

**Props:** `{ palette?: BrandTaxonomy["color"] }`

Renders color palette swatches with hex values (CARD-04):
- Section heading "Color Palette"
- Horizontal flex row of swatches wrapping
- Each swatch: a colored circle/rounded square (`w-12 h-12 rounded-lg`) with the hex color as background, plus the hex value below in mono text (`font-mono text-xs`)
- Optional role label below hex
- Click to copy hex (same pattern as admin ColorPaletteCard: navigator.clipboard.writeText with "Copied!" feedback)
- If no palette, show "No colors detected" in tertiary text

### BrandCardDescription.tsx (~70 lines)

**Props:** `{ identity?: BrandTaxonomy["identity"]; typography?: BrandTaxonomy["typography"] }`

Renders a description area in the extracted primary font (CARD-05):
- Determine primary font: find the first entry in `typography?.font_families` where `entry.value.source === "google_fonts"`, extract `entry.value.family`. If none found, set to null.
- Call `useGoogleFont(primaryFontFamily)` from `@/lib/brand-scraper/fonts`
- Display text: use `identity?.tagline` if available, else `identity?.industry_guess`, else the fallback "Brand typography preview"
- Render in a container with `style={{ fontFamily: loaded ? `"${primaryFontFamily}", sans-serif` : "sans-serif" }}`
- Add `transition-all duration-300` for smooth font swap
- Show the font family name below the text as metadata (`text-xs text-text-tertiary`)
- Section heading "Brand Identity"

### BrandCardDownloads.tsx (~80 lines)

**Props:** `{ brandJsonUrl?: string; jobId: string; token: string }`

Renders two download buttons aligned to the right (CARD-06):

1. **"Download Brand JSON File"** — a simple `<a>` styled as a secondary button. href = brandJsonUrl. Add `download="brand.json"` attribute. Disable/hide if no brandJsonUrl.

2. **"Download Assets"** — a button that triggers on-demand zip creation:
   - On click: set a `downloading` state to true, show "Preparing download..." text
   - POST to `/api/tools/brand-scraper/jobs/${jobId}/assets/zip` with `Authorization: Bearer ${token}`
   - On success: extract `zip_url` from response JSON, create a temporary `<a>` element, set href to zip_url, click it to trigger download
   - On error: show brief error state, then reset
   - On finally: set downloading to false

Use the project's `Button` component from `@/components/ui/Button` for consistent styling. The JSON button should be `variant="secondary"`, the ZIP button should be `variant="secondary"`. Both `size="sm"`.

Wrap both buttons in a `flex justify-end gap-3` container.

**All 5 components should:**
- Use Tailwind classes consistent with the project's navy/gold palette
- Be under 80 lines each (except Downloads which may be ~80)
- Import types from `@/lib/brand-scraper/types` using the `type` keyword for type-only imports
- NOT import the full page or container components — these are leaf components
  </action>
  <verify>
Run `npx tsc --noEmit` — zero type errors. Run `npm run lint` — clean. Verify all 5 files export their respective components. Verify BrandCardDescription imports `useGoogleFont`.
  </verify>
  <done>All 5 Brand Card section components exist and compile: BrandCardHeader (browser tab), BrandCardLogos (logo images), BrandCardColors (palette swatches), BrandCardDescription (text in extracted font), BrandCardDownloads (JSON + ZIP buttons).</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. `npm run lint` passes clean
3. `npm run test` — all existing tests still pass
4. All 6 new component files exist and export named components
5. ScrapeProgressPanel derives page_started/page_done/asset_saved from events
6. BrandCardDescription uses useGoogleFont hook
7. BrandCardDownloads POSTs to the zip proxy route with auth header
</verification>

<success_criteria>
- 6 new presentational components are created and compile cleanly
- Progress panel derives live page and file lists from pipeline events
- Brand Card sections cover all CARD requirements (header, logos, colors, description, downloads)
- Components use project conventions (Tailwind, navy/gold palette, Button component)
- All quality gates pass
</success_criteria>

<output>
After completion, create `.planning/phases/29-brand-card-progress-ui/29-02-SUMMARY.md`
</output>
