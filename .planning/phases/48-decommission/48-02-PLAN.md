---
phase: 48-decommission
plan: 02
type: execute
wave: 2
depends_on: [48-01]
files_modified:
  - src/lib/env.ts
  - src/lib/__tests__/env.test.ts
  - src/components/apps/TasksLandingPage.tsx
  - scripts/validate-env.ts
  - docs/SERVICE-REGISTRY.md
  - docs/CONFIGURATION-RESILIENCE.md
  - CLAUDE.md
autonomous: true
requirements: [DC-04, DC-05]

must_haves:
  truths:
    - "No code in src/ references NEXT_PUBLIC_TASKS_APP_URL"
    - "No code in src/ references tasks.dan-weinbeck.com as an external URL"
    - "TasksLandingPage uses internal /apps/tasks routes instead of external TASKS_URL"
    - "The apps hub listing for Tasks links to /apps/tasks with no external URL reference"
    - "All quality gates pass (lint, build, test)"
  artifacts:
    - path: "src/lib/env.ts"
      provides: "Client env schema without NEXT_PUBLIC_TASKS_APP_URL"
      contains: "clientEnvSchema"
    - path: "src/components/apps/TasksLandingPage.tsx"
      provides: "Tasks landing page with internal routing"
      contains: "/apps/tasks"
    - path: "docs/SERVICE-REGISTRY.md"
      provides: "Updated service registry without Tasks external service"
  key_links:
    - from: "src/components/apps/TasksLandingPage.tsx"
      to: "/apps/tasks"
      via: "internal Next.js route"
      pattern: "/apps/tasks"
---

<objective>
Remove all references to NEXT_PUBLIC_TASKS_APP_URL and the external tasks.dan-weinbeck.com URL from the codebase. Update TasksLandingPage to use internal routes. Update documentation to reflect the integrated architecture.

Purpose: With the standalone Tasks service decommissioned (Plan 48-01), all env var references, hardcoded URLs, and documentation pointing to the external service must be cleaned up. The Tasks app is now fully internal at /apps/tasks.

Output: Clean codebase with no external Tasks references, updated docs, all quality gates passing.
</objective>

<execution_context>
@/Users/dweinbeck/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dweinbeck/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/lib/env.ts
@src/components/apps/TasksLandingPage.tsx
@src/lib/__tests__/env.test.ts
@scripts/validate-env.ts
@docs/SERVICE-REGISTRY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove NEXT_PUBLIC_TASKS_APP_URL from env schema, validation, and tests</name>
  <files>
    src/lib/env.ts
    src/lib/__tests__/env.test.ts
    scripts/validate-env.ts
  </files>
  <action>
**src/lib/env.ts:**
1. Remove `NEXT_PUBLIC_TASKS_APP_URL: z.string().url().optional()` from `clientEnvSchema` (line 92).
2. Remove the `NEXT_PUBLIC_TASKS_APP_URL` entry from the `clientEnv()` function's parse input object (lines 272-273).
3. The `ClientEnv` type will automatically update since it's inferred from the schema.

**src/lib/__tests__/env.test.ts:**
1. Remove the test `"accepts optional NEXT_PUBLIC_TASKS_APP_URL"` (lines 38-44) which tests parsing with the URL.
2. Remove the test `"rejects invalid NEXT_PUBLIC_TASKS_APP_URL"` (lines 70-76) which tests invalid URL rejection.

**scripts/validate-env.ts:**
1. Remove the `NEXT_PUBLIC_TASKS_APP_URL` entry from the `clientInput` object (line 66).

After these changes, `NEXT_PUBLIC_TASKS_APP_URL` should have zero matches in `src/lib/env.ts`, `src/lib/__tests__/env.test.ts`, and `scripts/validate-env.ts`.
  </action>
  <verify>
Run `npm test -- --reporter=verbose src/lib/__tests__/env.test.ts` to confirm env tests pass with the field removed.
Run `grep -r "NEXT_PUBLIC_TASKS_APP_URL" src/lib/ scripts/` should return zero matches.
  </verify>
  <done>
NEXT_PUBLIC_TASKS_APP_URL is fully removed from the env validation system and all related tests pass.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update TasksLandingPage to use internal routes and remove external URL references</name>
  <files>
    src/components/apps/TasksLandingPage.tsx
  </files>
  <action>
The `TasksLandingPage` component currently defines `const TASKS_URL = clientEnv().NEXT_PUBLIC_TASKS_APP_URL || "https://tasks.dan-weinbeck.com"` and uses it for the "Launch App" and "Try Demo" buttons. Since Tasks is now integrated at /apps/tasks, update this component:

1. Remove the `import { clientEnv } from "@/lib/env"` import (line 7) since it was only used for TASKS_URL.
2. Remove the `const TASKS_URL = ...` line (lines 12-13).
3. In the authenticated user view (line 108), change `href={TASKS_URL}` to `href="/apps/tasks"`. This is the "Launch App" button — it should navigate to the integrated Tasks app.
4. In the unauthenticated view (line 156), change `href={\`${TASKS_URL}/demo\`}` to `href="/apps/tasks/demo"`. This is the "Try Demo" button.

After these changes, `TasksLandingPage.tsx` should have zero references to `TASKS_URL`, `clientEnv`, `tasks.dan-weinbeck.com`, or `NEXT_PUBLIC_TASKS_APP_URL`.

Note: Keep all other imports and functionality (GoogleAuthProvider, signInWithPopup, Button, Card, useAuth, getFirebaseAuth, features array, and the full component rendering logic) exactly as-is.
  </action>
  <verify>
Run `npm run build` to confirm the component compiles without the removed import.
Run `grep -r "tasks.dan-weinbeck.com\|NEXT_PUBLIC_TASKS_APP_URL\|TASKS_URL" src/components/apps/TasksLandingPage.tsx` should return zero matches.
  </verify>
  <done>
TasksLandingPage uses internal /apps/tasks routes exclusively with no external URL references.
  </done>
</task>

<task type="auto">
  <name>Task 3: Update documentation to remove Tasks external service references</name>
  <files>
    docs/SERVICE-REGISTRY.md
    docs/CONFIGURATION-RESILIENCE.md
    CLAUDE.md
  </files>
  <action>
**docs/SERVICE-REGISTRY.md:**
1. Remove the `NEXT_PUBLIC_TASKS_APP_URL` row from the Service URL Matrix table (line 15).
2. Update the Service Architecture Diagram (lines 99-126): Remove the `NEXT_PUBLIC_TASKS_APP_URL` arrow and the separate "Tasks App" box. Add a note that Tasks is now integrated at /apps/tasks within the personal-brand app.
3. Updated diagram should show only two external services (Chatbot and Brand Scraper) plus a note about Tasks being internal.

**docs/CONFIGURATION-RESILIENCE.md:**
1. Update the N x (N-1) URL Problem table (lines 52-59): Remove the "Tasks" column and the `NEXT_PUBLIC_TASKS_APP_URL` reference. The service count drops from 4 to 3 (personal-brand, brand-scraper, chatbot), so there are now 6 potential URL configurations (3 x 2), not 12 (4 x 3). Update the opening paragraph (line 52) to say "With 3 services" and "6 potential URL configurations".
2. Remove the Tasks row from the table.

**CLAUDE.md:**
1. In the Multi-Service Architecture section, remove the Tasks App row from the Service Map table (line 90 area: `| Tasks App | NEXT_PUBLIC_TASKS_APP_URL | ...`).
2. Update the Proven Configuration Mistakes table if needed — most entries are generic and still apply. No Tasks-specific entries need removal.
3. Update the `validate-env` gate section if it mentions NEXT_PUBLIC_TASKS_APP_URL.

After these changes, `grep -r "NEXT_PUBLIC_TASKS_APP_URL" docs/ CLAUDE.md` should return zero matches (excluding planning files which are historical records).
  </action>
  <verify>
Run `grep -r "NEXT_PUBLIC_TASKS_APP_URL" docs/ CLAUDE.md` should return zero matches.
Run `grep -r "tasks.dan-weinbeck.com" docs/ CLAUDE.md` should return zero matches (or only in historical context).
Run `npm run lint` to verify no lint errors in modified files.
Run `npm run build` to verify build passes.
Run `npm test` to verify all tests pass.
  </verify>
  <done>
All documentation accurately reflects the integrated Tasks architecture with no references to the standalone external Tasks service, NEXT_PUBLIC_TASKS_APP_URL, or tasks.dan-weinbeck.com.
  </done>
</task>

</tasks>

<verification>
1. `grep -rn "NEXT_PUBLIC_TASKS_APP_URL" src/ scripts/ docs/ CLAUDE.md` returns zero matches
2. `grep -rn "tasks.dan-weinbeck.com" src/ docs/ CLAUDE.md` returns zero matches
3. `npm test` passes (env tests updated, no broken imports)
4. `npm run lint` passes
5. `npm run build` passes
6. The /apps hub data file (`src/data/apps.ts`) still shows `href: "/apps/tasks"` (already correct from Phase 45)
</verification>

<success_criteria>
- DC-04: NEXT_PUBLIC_TASKS_APP_URL is completely removed from the personal-brand codebase (env schema, validation, tests, components, docs)
- DC-05: Apps hub and all UI components reference /apps/tasks exclusively with no external Tasks URL
- All quality gates pass (lint, build, test)
</success_criteria>

<output>
After completion, create `.planning/phases/48-decommission/48-02-SUMMARY.md`
</output>
