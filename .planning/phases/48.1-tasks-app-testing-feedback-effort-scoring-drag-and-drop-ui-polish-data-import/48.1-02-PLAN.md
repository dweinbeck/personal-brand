---
phase: 48.1-tasks-app-testing-feedback
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/tasks/billing/FreeWeekBanner.tsx
  - src/app/apps/tasks/(authenticated)/layout.tsx
autonomous: true
requirements: [TF-01]

must_haves:
  truths:
    - "Free Trial Week banner has an X button to dismiss it"
    - "Banner shows dynamic countdown of days remaining from sign-up date"
    - "Dismissed banner does not reappear on page navigation"
    - "Dismissal state persists across page refreshes (localStorage)"
  artifacts:
    - path: "src/components/tasks/billing/FreeWeekBanner.tsx"
      provides: "Dismissible free trial banner with countdown"
      contains: "localStorage"
  key_links:
    - from: "src/components/tasks/billing/FreeWeekBanner.tsx"
      to: "localStorage"
      via: "dismissal persistence"
      pattern: "localStorage"
---

<objective>
Make the Free Trial Week banner dismissible with an X button, show a dynamic countdown from the user's sign-up date, and persist dismissal state in localStorage.

Purpose: Users find the banner intrusive. It should be dismissible and informative (showing actual days remaining), not just a static message.
Output: A polished, dismissible trial banner with real countdown logic.
</objective>

<execution_context>
@/Users/dweinbeck/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dweinbeck/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/components/tasks/billing/FreeWeekBanner.tsx
@src/app/apps/tasks/(authenticated)/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement dismissible Free Trial Week banner with dynamic countdown</name>
  <files>
    src/components/tasks/billing/FreeWeekBanner.tsx
    src/app/apps/tasks/(authenticated)/layout.tsx
  </files>
  <action>
    **1. Update `FreeWeekBanner.tsx`** — Complete rewrite of the component:

    The component is already `"use client"`. Add state management for:
    - `dismissed` state (boolean) — initialized from localStorage key `"tasks-free-trial-dismissed"`
    - `daysLeft` state (number) — computed from `weekStart` prop

    Props to accept:
    - `weekStart: string` — ISO date string of when the free trial started (already available in layout from billing response)

    Logic:
    - On mount, check `localStorage.getItem("tasks-free-trial-dismissed")` — if truthy, render nothing
    - Compute days left: `Math.max(0, 7 - daysSinceStart)` where `daysSinceStart = Math.floor((Date.now() - new Date(weekStart).getTime()) / 86400000)`
    - If daysLeft <= 0, show "Your free trial has ended" instead of countdown

    UI:
    - Keep the emerald-50/emerald-200 color scheme
    - Add an X button in the top-right corner: `absolute top-2 right-2` positioned
    - Make the outer div `relative` for the absolute positioning
    - Text: "Free trial week. You have {daysLeft} day{s} left in your trial."
    - X button onClick: set `dismissed` to true, `localStorage.setItem("tasks-free-trial-dismissed", "true")`
    - X button styling: `text-emerald-600 hover:text-emerald-800 transition-colors cursor-pointer`

    **2. Update `layout.tsx`** — Pass `weekStart` prop to FreeWeekBanner:

    The layout already has the `billing` object. The `weekStart` is available from the billing response. Pass it through:
    ```tsx
    {billing.reason === "free_week" && <FreeWeekBanner weekStart={billing.weekStart ?? new Date().toISOString()} />}
    ```

    The billing response type already has `weekStart: string` — this is the date when the free week started.

    Note: Use `useState` with lazy initializer to avoid SSR mismatch with localStorage:
    ```tsx
    const [dismissed, setDismissed] = useState(() => {
      if (typeof window === "undefined") return false;
      return localStorage.getItem("tasks-free-trial-dismissed") === "true";
    });
    ```
  </action>
  <verify>
    - `npm run lint` passes
    - `npm run build` passes
    - FreeWeekBanner accepts `weekStart` prop
    - Component checks localStorage for dismissal state
    - X button calls localStorage.setItem on click
    - Days left calculation uses weekStart prop
  </verify>
  <done>
    Free Trial Week banner:
    1. Shows an X button in the top right that dismisses it
    2. Displays "You have X days left in your trial" with dynamic countdown from sign-up date
    3. Does not reappear after dismissal (localStorage persists)
    4. Handles edge case where trial has ended
  </done>
</task>

</tasks>

<verification>
- `npm run lint && npm run build && npm test` — all pass
- FreeWeekBanner renders X button and countdown text
- Dismissal persists in localStorage
</verification>

<success_criteria>
1. Banner has clickable X button that hides it
2. Banner shows accurate days remaining based on weekStart
3. Dismissed state persists in localStorage across page loads
4. Build and lint pass
</success_criteria>

<output>
After completion, create `.planning/phases/48.1-tasks-app-testing-feedback-effort-scoring-drag-and-drop-ui-polish-data-import/48.1-02-SUMMARY.md`
</output>
