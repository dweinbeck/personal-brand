---
phase: 35-demo-workspace
plan: 02
type: execute
wave: 2
depends_on: ["35-01"]
files_modified:
  - /Users/dweinbeck/Documents/todoist/src/components/demo/DemoBanner.tsx
  - /Users/dweinbeck/Documents/todoist/src/app/demo/layout.tsx
  - /Users/dweinbeck/Documents/todoist/src/components/tasks/task-card.tsx
  - /Users/dweinbeck/Documents/todoist/src/components/tasks/subtask-list.tsx
  - /Users/dweinbeck/Documents/todoist/src/components/tasks/section-header.tsx
  - /Users/dweinbeck/Documents/todoist/src/components/auth/AuthGuard.tsx
autonomous: true

must_haves:
  truths:
    - "A persistent DEMO banner is visible at the top of every demo page explaining data is temporary, with a 'Sign Up Free' CTA linking to /tasks"
    - "Clicking the toggle/edit/delete buttons on TaskCard in demo mode does nothing -- no crash, no server call"
    - "Clicking subtask toggle/delete/add buttons in SubtaskList in demo mode does nothing -- no crash, no server call"
    - "Clicking section rename/delete in SectionHeader in demo mode does nothing -- no crash, no server call"
    - "Unauthenticated visitors see a 'Try Demo' link on the sign-in screen that navigates to /demo"
    - "Non-demo mode (regular /tasks usage) is completely unaffected -- all mutations still work normally"
  artifacts:
    - path: "src/components/demo/DemoBanner.tsx"
      provides: "Sticky banner with DEMO badge, explanatory text, and Sign Up CTA"
      exports: ["DemoBanner"]
    - path: "src/app/demo/layout.tsx"
      provides: "Demo layout updated to include DemoBanner above sidebar/main flex"
    - path: "src/components/tasks/task-card.tsx"
      provides: "TaskCard with useDemoMode guard on toggle, edit, delete actions"
      contains: "useDemoMode"
    - path: "src/components/tasks/subtask-list.tsx"
      provides: "SubtaskList with useDemoMode guard on toggle, delete, add actions"
      contains: "useDemoMode"
    - path: "src/components/tasks/section-header.tsx"
      provides: "SectionHeader with useDemoMode guard on rename and delete"
      contains: "useDemoMode"
    - path: "src/components/auth/AuthGuard.tsx"
      provides: "AuthGuard with 'Try Demo' link for unauthenticated users"
      contains: "Try Demo"
  key_links:
    - from: "src/components/tasks/task-card.tsx"
      to: "src/lib/demo.ts"
      via: "useDemoMode() returns true in demo context, false otherwise"
      pattern: "useDemoMode"
    - from: "src/components/tasks/subtask-list.tsx"
      to: "src/lib/demo.ts"
      via: "useDemoMode() guards all mutation handlers"
      pattern: "useDemoMode"
    - from: "src/components/tasks/section-header.tsx"
      to: "src/lib/demo.ts"
      via: "useDemoMode() guards rename and delete"
      pattern: "useDemoMode"
    - from: "src/app/demo/layout.tsx"
      to: "src/components/demo/DemoBanner.tsx"
      via: "Banner rendered above sidebar/main flex container"
      pattern: "DemoBanner"
---

<objective>
Add the persistent DEMO banner with sign-up CTA, guard all mutation UI in existing components for demo mode safety, and add a "Try Demo" entry point on the sign-in screen.

Purpose: Ensures demo visitors see clear "this is a demo" messaging at all times, cannot trigger any mutations (which would crash due to null auth), and have a clear path to sign up. Also provides an entry point for unauthenticated users to discover the demo.

Output: Complete, safe, polished demo experience with mutation lockout and sign-up funneling.
</objective>

<execution_context>
@/Users/dweinbeck/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dweinbeck/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/dweinbeck/Documents/personal-brand/.planning/PROJECT.md
@/Users/dweinbeck/Documents/personal-brand/.planning/ROADMAP.md
@/Users/dweinbeck/Documents/personal-brand/.planning/STATE.md
@/Users/dweinbeck/Documents/personal-brand/.planning/phases/35-demo-workspace/35-RESEARCH.md
@/Users/dweinbeck/Documents/personal-brand/.planning/phases/35-demo-workspace/35-01-SUMMARY.md

NOTE: This plan executes in the todoist repo at /Users/dweinbeck/Documents/todoist

Key files to modify:
@/Users/dweinbeck/Documents/todoist/src/components/tasks/task-card.tsx
@/Users/dweinbeck/Documents/todoist/src/components/tasks/subtask-list.tsx
@/Users/dweinbeck/Documents/todoist/src/components/tasks/section-header.tsx
@/Users/dweinbeck/Documents/todoist/src/components/auth/AuthGuard.tsx
@/Users/dweinbeck/Documents/todoist/src/lib/demo.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DemoBanner and wire into demo layout</name>
  <files>
    /Users/dweinbeck/Documents/todoist/src/components/demo/DemoBanner.tsx
    /Users/dweinbeck/Documents/todoist/src/app/demo/layout.tsx
  </files>
  <action>
**File 1: `src/components/demo/DemoBanner.tsx`**
- `"use client"` component
- Sticky banner at the top of the demo layout: `sticky top-0 z-50`
- Use the app's primary navy color for background: `bg-primary text-white`
- Left side: A "DEMO" badge (small, uppercase, semi-transparent background: `bg-white/20 px-2 py-0.5 rounded text-xs uppercase tracking-wider font-semibold`) followed by text: "You are viewing a demo workspace. Data is temporary and will not be saved."
- Right side: "Sign Up Free" CTA button linking to `/tasks` (this will trigger the auth flow since /tasks requires sign-in). Style: gold background (`bg-gold text-primary font-medium rounded-[var(--radius-button)] hover:bg-gold-hover transition-colors text-xs px-4 py-1.5`).
- Use `Link` from `next/link` for the CTA.
- Layout: `flex items-center justify-between px-4 py-2 text-sm`

**File 2: Update `src/app/demo/layout.tsx`**
- Read the existing file from Plan 01, then add `DemoBanner` import and render it ABOVE the sidebar/main flex container.
- Final structure:
```
<DemoModeProvider value={true}>
  <DemoProvider>
    <div className="flex flex-col h-screen">
      <DemoBanner />
      <div className="flex flex-1 overflow-hidden">
        <DemoSidebar />
        <main className="flex-1 overflow-y-auto">
          {children}
        </main>
      </div>
    </div>
  </DemoProvider>
</DemoModeProvider>
```
  </action>
  <verify>
Run `cd /Users/dweinbeck/Documents/todoist && npx tsc --noEmit` -- zero type errors.
  </verify>
  <done>
DemoBanner renders at the top of every demo page with "DEMO" badge, explanatory text, and "Sign Up Free" CTA linking to /tasks. Banner stays visible during scroll (sticky).
  </done>
</task>

<task type="auto">
  <name>Task 2: Guard mutations in TaskCard, SubtaskList, SectionHeader + add Try Demo link to AuthGuard</name>
  <files>
    /Users/dweinbeck/Documents/todoist/src/components/tasks/task-card.tsx
    /Users/dweinbeck/Documents/todoist/src/components/tasks/subtask-list.tsx
    /Users/dweinbeck/Documents/todoist/src/components/tasks/section-header.tsx
    /Users/dweinbeck/Documents/todoist/src/components/auth/AuthGuard.tsx
  </files>
  <action>
**IMPORTANT:** The `useDemoMode()` hook returns `false` by default (the context defaults to `false`). This means all changes below are NO-OPs in the normal `/tasks` route -- existing functionality is completely unaffected. Only inside the `/demo` route tree (where `DemoModeProvider value={true}` wraps everything) will `isDemo` be `true`.

**File 1: `src/components/tasks/task-card.tsx`**
- Add `import { useDemoMode } from "@/lib/demo";`
- At the top of the `TaskCard` component: `const isDemo = useDemoMode();`
- Guard `handleToggle`: if `isDemo`, return early (do nothing). Change the toggle button: `onClick={isDemo ? undefined : handleToggle}` and add `className` condition for `isDemo && "opacity-60 cursor-default"`.
- Guard the edit button: in demo mode, hide the entire hover action group. Wrap the edit/delete button container with `{!isDemo && (...)}`.
- Guard `setEditing(true)`: since edit/delete buttons are hidden, this is already covered.
- The `handleDelete` function is already guarded because the delete button is hidden.
- The expand/collapse toggle (clicking the task name to see description/subtasks) should still work in demo mode -- it is display-only.

**File 2: `src/components/tasks/subtask-list.tsx`**
- Add `import { useDemoMode } from "@/lib/demo";`
- At the top of the `SubtaskList` component: `const isDemo = useDemoMode();`
- Guard the subtask toggle buttons: `onClick={isDemo ? undefined : async () => { ... }}` and add opacity/cursor classes when demo.
- Hide the subtask delete button (X icon) in demo mode: `{!isDemo && (<button ...>X</button>)}`.
- Hide the "+ Add subtask" button in demo mode: `{!isDemo && (<button ...>+ Add subtask</button>)}`.
- The adding form is already gated behind the hidden button so it never appears.

**File 3: `src/components/tasks/section-header.tsx`**
- Add `import { useDemoMode } from "@/lib/demo";`
- At the top of the `SectionHeader` component: `const isDemo = useDemoMode();`
- Guard the section name click-to-edit: Change the section name `<button onClick={() => setEditing(true)}>` to `<button onClick={isDemo ? undefined : () => setEditing(true)} className={cn("...", isDemo && "cursor-default")}>` -- or better, render a `<span>` instead of `<button>` in demo mode so the name is not clickable at all. Use: `{isDemo ? <span className="text-sm font-semibold text-text-primary">...</span> : <button onClick={() => setEditing(true)}>...</button>}`.
- Hide the delete section button in demo mode: wrap with `{!isDemo && (<button ...>delete</button>)}`.

**File 4: `src/components/auth/AuthGuard.tsx`**
- In the `!user` (unauthenticated) branch, add a "Try Demo" link below the "Sign in with Google" button.
- Add `import Link from "next/link";`
- After the sign-in button, add:
```tsx
<Link
  href="/demo"
  className="text-sm text-text-tertiary hover:text-gold transition-colors"
>
  or try the demo
</Link>
```
- This gives unauthenticated visitors a clear path to discover the demo workspace.
  </action>
  <verify>
1. Run `cd /Users/dweinbeck/Documents/todoist && npx tsc --noEmit` -- zero type errors.
2. Run `cd /Users/dweinbeck/Documents/todoist && npm run build` -- build succeeds.
3. Run `cd /Users/dweinbeck/Documents/todoist && npm run lint` -- no lint errors.
4. Run `cd /Users/dweinbeck/Documents/todoist && npm test` -- all existing tests pass.
5. Verify demo mode is scoped: `grep -n "useDemoMode" src/components/tasks/task-card.tsx src/components/tasks/subtask-list.tsx src/components/tasks/section-header.tsx` -- confirms guard is present in all three files.
6. Verify no server imports in demo components: `grep -r "from.*@/lib/auth\|from.*@/services\|from.*@/actions\|server-only" src/app/demo/ src/components/demo/` -- zero matches.
  </verify>
  <done>
- DemoBanner visible on all demo pages with "DEMO" badge and "Sign Up Free" CTA
- TaskCard: toggle button is inert in demo mode (no crash), edit/delete buttons hidden in demo mode
- SubtaskList: toggle is inert, delete and add buttons hidden in demo mode
- SectionHeader: name is not editable in demo mode, delete button hidden
- AuthGuard shows "or try the demo" link for unauthenticated users
- All mutations still work normally in /tasks (non-demo) routes -- zero behavioral change for authenticated users
- Build, lint, type-check, and all tests pass
  </done>
</task>

</tasks>

<verification>
1. `cd /Users/dweinbeck/Documents/todoist && npx tsc --noEmit` -- zero type errors
2. `cd /Users/dweinbeck/Documents/todoist && npm run build` -- build succeeds
3. `cd /Users/dweinbeck/Documents/todoist && npm run lint` -- no lint errors
4. `cd /Users/dweinbeck/Documents/todoist && npm test` -- all existing tests pass
5. Grep for `useDemoMode` in task components confirms guards are wired
6. Grep for server imports in demo tree confirms zero server dependencies
7. Grep for "Try Demo" or "try the demo" in AuthGuard confirms entry point exists
</verification>

<success_criteria>
- Persistent DEMO banner visible at top of all demo pages with CTA to sign up
- All mutation UI in demo mode is disabled or hidden (toggle, edit, delete on tasks; toggle, delete, add on subtasks; rename, delete on sections)
- No runtime crashes when browsing demo (no null user dereference)
- AuthGuard sign-in screen shows "try the demo" link to /demo
- Regular /tasks functionality is completely unaffected
- Build, lint, type-check, and all tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/35-demo-workspace/35-02-SUMMARY.md`
</output>
