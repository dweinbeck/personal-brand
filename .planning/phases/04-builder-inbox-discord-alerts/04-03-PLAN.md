---
phase: 04-builder-inbox-discord-alerts
plan: 03
type: execute
wave: 2
depends_on: [04-01]
files_modified:
  - src/lib/gsd/discord.ts
  - src/lib/gsd/router.ts
autonomous: true
requirements:
  - DISCORD-WEBHOOK
  - DISCORD-ALERTS

must_haves:
  truths:
    - "sendDiscordAlert sends a formatted embed to Discord webhook URL"
    - "Discord alerts are fire-and-forget (never block capture processing)"
    - "Alerts sent on capture routed and capture failed events"
    - "429 rate limit handled with retry-after header"
    - "Embed includes capture type, destination, confidence, and title"
    - "npm run build succeeds"
    - "npm run lint passes"
---

<objective>
Create Discord webhook utility and wire alerts into the routing pipeline. Admin gets Discord notifications when captures are processed.

Purpose: Real-time awareness of capture activity without checking the Builder Inbox. Supplements the admin UI.

Output: 1 new file (discord.ts), 1 updated file (router.ts with alert calls).
</objective>

<execution_context>
@/Users/dweinbeck/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dweinbeck/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@src/lib/gsd/router.ts
@src/lib/env.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Discord webhook utility</name>
  <files>
    src/lib/gsd/discord.ts
  </files>
  <action>
    Native fetch to Discord webhook. Fire-and-forget with 429 retry-after handling.
    Embed format with color coding by status (green=routed, red=failed).
  </action>
</task>

<task type="auto">
  <name>Task 2: Wire Discord alerts into processCapture</name>
  <files>
    src/lib/gsd/router.ts
  </files>
  <action>
    After marking as routed → send success alert.
    After marking as failed → send failure alert.
    Both calls fire-and-forget with .catch(console.error).
  </action>
</task>

</tasks>

<verification>
1. npm run lint — zero errors
2. npm run build — zero errors
3. npm test — all tests pass
</verification>

<success_criteria>
- Discord alerts sent on capture routed and failed events
- 429 retry-after handling prevents rate limit issues
- Fire-and-forget never blocks capture processing
- Embed includes routing metadata
</success_criteria>

<output>
After completion, create `.planning/phases/04-builder-inbox-discord-alerts/04-03-SUMMARY.md`
</output>
