---
phase: 45-ui-components-routing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/tasks/types.ts
  - src/lib/tasks/effort.ts
  - src/lib/tasks/demo.ts
  - src/lib/tasks/auth.ts
  - src/lib/utils.ts
  - src/components/tasks/ui/button.tsx
  - src/components/tasks/ui/input.tsx
  - src/components/tasks/ui/modal.tsx
  - src/components/tasks/ui/badge.tsx
  - src/components/tasks/ui/confirm-dialog.tsx
  - src/components/tasks/auth/AuthGuard.tsx
  - src/components/tasks/billing/BillingProvider.tsx
  - src/components/tasks/billing/FreeWeekBanner.tsx
  - src/components/tasks/billing/ReadOnlyBanner.tsx
  - src/components/tasks/task-card.tsx
  - src/components/tasks/task-form.tsx
  - src/components/tasks/subtask-list.tsx
  - src/components/tasks/board-view.tsx
  - src/components/tasks/section-header.tsx
  - src/components/tasks/add-task-button.tsx
  - src/components/tasks/add-section-button.tsx
  - src/components/tasks/quick-add-modal.tsx
  - src/components/tasks/sidebar.tsx
  - src/context/AuthContext.tsx
autonomous: true
requirements: [MIG-04]

must_haves:
  truths:
    - "All Tasks UI components exist in src/components/tasks/ and compile without errors"
    - "Tasks-specific UI primitives (Button, Input, Modal, Badge, ConfirmDialog) are namespaced under src/components/tasks/ui/ and do NOT overwrite personal-brand's existing src/components/ui/ files"
    - "Tasks types (TaskWithRelations, ProjectWithSections, SidebarWorkspace, etc.) are importable from @/lib/tasks/types"
    - "cn utility function exists at @/lib/utils for Tailwind class merging"
    - "getUserIdFromCookie function exists in @/lib/tasks/auth for server-side cookie authentication"
    - "AuthContext sets __session cookie so server components can read auth state"
  artifacts:
    - path: "src/components/tasks/task-card.tsx"
      provides: "TaskCard component"
      min_lines: 20
    - path: "src/components/tasks/sidebar.tsx"
      provides: "Sidebar component with /apps/tasks paths"
      min_lines: 50
    - path: "src/lib/tasks/types.ts"
      provides: "TaskWithRelations, ProjectWithSections, SidebarWorkspace types"
      exports: ["TaskWithRelations", "ProjectWithSections", "SidebarWorkspace"]
    - path: "src/lib/utils.ts"
      provides: "cn utility for class merging"
      exports: ["cn"]
  key_links:
    - from: "src/components/tasks/task-card.tsx"
      to: "@/actions/tasks/task"
      via: "server action imports"
      pattern: "from.*@/actions/tasks/task"
    - from: "src/components/tasks/sidebar.tsx"
      to: "@/actions/tasks/workspace"
      via: "server action imports"
      pattern: "from.*@/actions/tasks"
    - from: "src/components/tasks/task-card.tsx"
      to: "@/lib/tasks/types"
      via: "type imports"
      pattern: "from.*@/lib/tasks/types"
---

<objective>
Copy all Tasks UI components from the todoist app to the personal-brand app, adapting all imports to the personal-brand module structure. Also copy supporting files: types, utility libraries, and the auth cookie mechanism.

Purpose: Provide all the UI building blocks that route pages (Plan 02) and the Tasks layout (Plan 03) will compose into the full Tasks interface.
Output: 23+ files in src/components/tasks/, src/lib/tasks/, and src/lib/utils.ts
</objective>

<execution_context>
@/Users/dweinbeck/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dweinbeck/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/44-server-side-code-migration/44-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Copy types, utility libs, and auth cookie helper</name>
  <files>
    src/lib/tasks/types.ts
    src/lib/tasks/effort.ts
    src/lib/tasks/demo.ts
    src/lib/tasks/auth.ts
    src/lib/utils.ts
    src/context/AuthContext.tsx
  </files>
  <action>
Create these supporting files by copying from the todoist app at /Users/dweinbeck/ai/todoist/ and adapting imports:

**1. src/lib/tasks/types.ts** — Copy from /Users/dweinbeck/ai/todoist/src/types/index.ts verbatim. It imports from `@/generated/prisma/client` which already exists in personal-brand at the same path.

**2. src/lib/tasks/effort.ts** — Copy from /Users/dweinbeck/ai/todoist/src/lib/effort.ts verbatim (no import changes needed — it has no project-specific imports).

**3. src/lib/tasks/demo.ts** — Copy from /Users/dweinbeck/ai/todoist/src/lib/demo.ts verbatim (no import changes needed — only React imports).

**4. src/lib/tasks/auth.ts** — The file already exists with `verifyUser()`. ADD a new `getUserIdFromCookie()` function to this file (do NOT overwrite the existing content). The function reads the `__session` cookie and calls verifyUser. Copy the implementation from /Users/dweinbeck/ai/todoist/src/lib/auth.ts lines 21-29, but import `cookies` from `next/headers` and call the existing `verifyUser` from the same file. Add `import { cookies } from "next/headers"` at the top.

**5. src/lib/utils.ts** — Create a new file with the `cn` utility function. Copy from /Users/dweinbeck/ai/todoist/src/lib/utils.ts verbatim. Personal-brand already has `clsx` installed so this will work.

**6. src/context/AuthContext.tsx** — Modify the existing file to add `__session` cookie management. The todoist AuthContext uses `onIdTokenChanged` (not `onAuthStateChanged`) and sets a `__session` cookie when the user authenticates. This cookie is required for server components to read auth state via `getUserIdFromCookie`. Changes needed:
  - Change `onAuthStateChanged` to `onIdTokenChanged` (import from firebase/auth)
  - Add cookie-setting logic: when user authenticates, set `__session=${token}` cookie; when user signs out, clear it
  - Add the `hadCookie` check and `window.location.reload()` pattern from todoist's AuthContext so the server can render authenticated layouts on first load
  - Keep the existing `AuthProvider` and `useAuth` exports unchanged (same interface)
  - Reference /Users/dweinbeck/ai/todoist/src/context/AuthContext.tsx for the exact implementation

IMPORTANT: Do NOT use `import "server-only"` in types.ts, effort.ts, or demo.ts — they're used by client components. Only auth.ts already has it (and needs it since it uses cookies).
  </action>
  <verify>
Run `npx tsc --noEmit` to verify all new files type-check. Verify `src/lib/tasks/types.ts` exports TaskWithRelations, ProjectWithSections, SidebarWorkspace. Verify `src/lib/utils.ts` exports cn. Verify `src/lib/tasks/auth.ts` exports both verifyUser and getUserIdFromCookie.
  </verify>
  <done>
Types file exports 5 type aliases importing from Prisma generated client. effort.ts exports EFFORT_VALUES and computeEffortSum. demo.ts exports DemoModeProvider and useDemoMode. auth.ts exports verifyUser (existing) AND getUserIdFromCookie (new). utils.ts exports cn function. AuthContext sets __session cookie on auth state change.
  </done>
</task>

<task type="auto">
  <name>Task 2: Copy Tasks-specific UI primitives (namespaced) and all feature components</name>
  <files>
    src/components/tasks/ui/button.tsx
    src/components/tasks/ui/input.tsx
    src/components/tasks/ui/modal.tsx
    src/components/tasks/ui/badge.tsx
    src/components/tasks/ui/confirm-dialog.tsx
    src/components/tasks/auth/AuthGuard.tsx
    src/components/tasks/billing/BillingProvider.tsx
    src/components/tasks/billing/FreeWeekBanner.tsx
    src/components/tasks/billing/ReadOnlyBanner.tsx
    src/components/tasks/task-card.tsx
    src/components/tasks/task-form.tsx
    src/components/tasks/subtask-list.tsx
    src/components/tasks/board-view.tsx
    src/components/tasks/section-header.tsx
    src/components/tasks/add-task-button.tsx
    src/components/tasks/add-section-button.tsx
    src/components/tasks/quick-add-modal.tsx
    src/components/tasks/sidebar.tsx
  </files>
  <action>
Copy all UI components from /Users/dweinbeck/ai/todoist/src/components/ into src/components/tasks/ with the following import path adaptations:

**A. Tasks-specific UI primitives** — Copy to src/components/tasks/ui/ (NOT src/components/ui/ to avoid conflicts with personal-brand's existing Button, Card, Modal):

- `button.tsx` — Copy from todoist/src/components/ui/button.tsx. Change `@/lib/utils` import (cn is now at that path in personal-brand).
- `input.tsx` — Copy from todoist/src/components/ui/input.tsx. Same cn import change.
- `modal.tsx` — Copy from todoist/src/components/ui/modal.tsx. Same cn import change.
- `badge.tsx` — Copy from todoist/src/components/ui/badge.tsx. Same cn import change.
- `confirm-dialog.tsx` — Copy from todoist/src/components/ui/confirm-dialog.tsx. Change its internal imports from `./button` and `./modal` to `./button` and `./modal` (stays relative within tasks/ui/).

**B. Auth/Billing components** — Copy to src/components/tasks/auth/ and src/components/tasks/billing/:

- `AuthGuard.tsx` — Copy from todoist/src/components/auth/AuthGuard.tsx. Keep `@/context/AuthContext` import (same in personal-brand). Keep `@/lib/firebase-client` import (same in personal-brand). Change the demo link from `"/demo"` to `"/apps/tasks/demo"`.
- `BillingProvider.tsx` — Copy from todoist/src/components/billing/BillingProvider.tsx verbatim (no project-specific imports).
- `FreeWeekBanner.tsx` — Copy from todoist/src/components/billing/FreeWeekBanner.tsx verbatim.
- `ReadOnlyBanner.tsx` — Copy from todoist/src/components/billing/ReadOnlyBanner.tsx verbatim.

**C. Feature components** — Copy to src/components/tasks/:

For ALL feature components below, apply these import path changes:
- `@/actions/task` -> `@/actions/tasks/task`
- `@/actions/project` -> `@/actions/tasks/project`
- `@/actions/section` -> `@/actions/tasks/section`
- `@/actions/workspace` -> `@/actions/tasks/workspace`
- `@/actions/tag` -> `@/actions/tasks/tag`
- `@/components/ui/badge` -> `@/components/tasks/ui/badge`
- `@/components/ui/button` -> `@/components/tasks/ui/button`
- `@/components/ui/input` -> `@/components/tasks/ui/input`
- `@/components/ui/modal` -> `@/components/tasks/ui/modal`
- `@/components/ui/confirm-dialog` -> `@/components/tasks/ui/confirm-dialog`
- `@/components/tasks/quick-add-modal` stays as `@/components/tasks/quick-add-modal` (already correct)
- `@/components/tasks/task-card` stays (already correct)
- `@/components/tasks/task-form` -> `./task-form` (relative, same directory)
- `@/components/tasks/subtask-list` -> `./subtask-list` (relative, same directory)
- `@/components/tasks/add-section-button` stays (already correct)
- `@/components/tasks/add-task-button` stays (already correct)
- `@/components/tasks/board-view` stays (already correct)
- `@/components/tasks/section-header` stays (already correct)
- `@/context/AuthContext` -> `@/context/AuthContext` (same path, personal-brand has same structure)
- `@/lib/utils` -> `@/lib/utils` (cn is now here)
- `@/lib/effort` -> `@/lib/tasks/effort`
- `@/lib/demo` -> `@/lib/tasks/demo`
- `@/types` -> `@/lib/tasks/types`
- `@/generated/prisma/client` -> `@/generated/prisma/client` (same path)

Files to copy:
1. `task-card.tsx` — from todoist/src/components/tasks/task-card.tsx
2. `task-form.tsx` — from todoist/src/components/tasks/task-form.tsx
3. `subtask-list.tsx` — from todoist/src/components/tasks/subtask-list.tsx
4. `board-view.tsx` — from todoist/src/components/tasks/board-view.tsx
5. `section-header.tsx` — from todoist/src/components/tasks/section-header.tsx
6. `add-task-button.tsx` — from todoist/src/components/tasks/add-task-button.tsx
7. `add-section-button.tsx` — from todoist/src/components/tasks/add-section-button.tsx
8. `quick-add-modal.tsx` — from todoist/src/components/tasks/quick-add-modal.tsx

**D. Sidebar** — Copy from todoist/src/components/tasks/sidebar.tsx to src/components/tasks/sidebar.tsx with CRITICAL path changes:
- All imports adapted per the mapping above
- Change ALL `/tasks/...` route paths to `/apps/tasks/...` in the navItems array AND in Link href attributes throughout the file:
  - `"/tasks/today"` -> `"/apps/tasks/today"`
  - `"/tasks/completed"` -> `"/apps/tasks/completed"`
  - `"/tasks/search"` -> `"/apps/tasks/search"`
  - `"/tasks/tags"` -> `"/apps/tasks/tags"`
  - `"/tasks"` -> `"/apps/tasks"` (the sidebar heading link)
  - `` `/tasks/${project.id}` `` -> `` `/apps/tasks/${project.id}` ``
  - pathname comparisons: `pathname === \`/tasks/${project.id}\`` -> `pathname === \`/apps/tasks/${project.id}\``
- Per requirement SB-02: Remove the "Tasks" heading section from the sidebar. Specifically, remove the `<div className="p-4 border-b border-border">` block that contains the `<Link href="/tasks">` with "Tasks" text (approximately lines 146-151 of the source file). The sidebar should start directly with the "Add Task" button area.

IMPORTANT: Do NOT modify personal-brand's existing src/components/ui/Button.tsx, Card.tsx, Modal.tsx, or CardButtonLabel.tsx. The Tasks UI primitives are entirely separate in src/components/tasks/ui/.
  </action>
  <verify>
Run `npm run build` to verify all components compile. Verify no files in src/components/ui/ were modified with `git diff src/components/ui/`. Grep for `/tasks/today` (without /apps prefix) in src/components/tasks/ to ensure all paths were updated -- should find ZERO matches. Grep for `@/components/ui/` imports in src/components/tasks/ -- should find ZERO matches (all should use @/components/tasks/ui/).
  </verify>
  <done>
18 component files exist in src/components/tasks/. All import paths reference personal-brand modules (@/actions/tasks/*, @/components/tasks/ui/*, @/lib/tasks/*, @/context/AuthContext). No personal-brand UI components were overwritten. Sidebar uses /apps/tasks/ paths. "Tasks" heading removed from sidebar (SB-02). Build passes.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` passes with zero errors
2. `npm run lint` passes with zero errors (Biome import ordering may need fixes)
3. No files modified in src/components/ui/ (personal-brand's existing UI untouched)
4. All Tasks component imports resolve to personal-brand paths, not todoist paths
5. Sidebar navigation links all use /apps/tasks/ prefix
6. "Tasks" heading is NOT present in sidebar component
</verification>

<success_criteria>
- All 23+ files exist and compile
- Build passes
- Lint passes
- No conflicts with personal-brand's existing Button.tsx, Card.tsx, Modal.tsx
- getUserIdFromCookie and __session cookie mechanism ready for server component usage
</success_criteria>

<output>
After completion, create `.planning/phases/45-ui-components-routing/45-01-SUMMARY.md`
</output>
