---
phase: 45-ui-components-routing
plan: 02
type: execute
wave: 2
depends_on: ["45-01"]
files_modified:
  - src/app/apps/tasks/layout.tsx
  - src/app/apps/tasks/page.tsx
  - src/app/apps/tasks/[projectId]/page.tsx
  - src/app/apps/tasks/[projectId]/project-view.tsx
  - src/app/apps/tasks/today/page.tsx
  - src/app/apps/tasks/completed/page.tsx
  - src/app/apps/tasks/completed/completed-view.tsx
  - src/app/apps/tasks/search/page.tsx
  - src/app/apps/tasks/search/search-input.tsx
  - src/app/apps/tasks/tags/page.tsx
  - src/app/apps/tasks/tags/tag-list.tsx
  - src/app/apps/tasks/tags/[tagId]/page.tsx
autonomous: true
requirements: [RT-01, RT-02, SB-01, SB-02, SB-03]

must_haves:
  truths:
    - "Visiting /apps/tasks renders the Tasks landing page inside the personal-brand layout"
    - "The Tasks sidebar appears in the /apps/tasks layout with workspaces, projects, smart views, and tags"
    - "Sidebar does NOT include a redundant 'Tasks' heading"
    - "All sidebar navigation links use /apps/tasks/... paths"
    - "/apps/tasks/[projectId] renders a project view with list/board toggle"
    - "/apps/tasks/today renders tasks due today"
    - "/apps/tasks/completed renders completed tasks with project filter"
    - "/apps/tasks/search renders search interface with query results"
    - "/apps/tasks/tags renders tag list with create/delete"
    - "/apps/tasks/tags/[tagId] renders tasks filtered by a specific tag"
  artifacts:
    - path: "src/app/apps/tasks/layout.tsx"
      provides: "Tasks layout with sidebar, billing, auth"
      min_lines: 30
    - path: "src/app/apps/tasks/page.tsx"
      provides: "Tasks landing page"
      min_lines: 10
    - path: "src/app/apps/tasks/[projectId]/page.tsx"
      provides: "Project detail page"
      min_lines: 10
    - path: "src/app/apps/tasks/today/page.tsx"
      provides: "Today view page"
      min_lines: 10
    - path: "src/app/apps/tasks/completed/page.tsx"
      provides: "Completed view page"
      min_lines: 10
    - path: "src/app/apps/tasks/search/page.tsx"
      provides: "Search page"
      min_lines: 10
    - path: "src/app/apps/tasks/tags/page.tsx"
      provides: "Tags management page"
      min_lines: 10
    - path: "src/app/apps/tasks/tags/[tagId]/page.tsx"
      provides: "Tag detail page"
      min_lines: 10
  key_links:
    - from: "src/app/apps/tasks/layout.tsx"
      to: "@/components/tasks/sidebar"
      via: "import Sidebar component"
      pattern: "from.*@/components/tasks/sidebar"
    - from: "src/app/apps/tasks/layout.tsx"
      to: "@/lib/tasks/auth"
      via: "getUserIdFromCookie for server-side auth"
      pattern: "getUserIdFromCookie"
    - from: "src/app/apps/tasks/[projectId]/page.tsx"
      to: "@/services/tasks/project.service"
      via: "getProject service call"
      pattern: "from.*@/services/tasks/project.service"
    - from: "src/app/apps/tasks/completed/completed-view.tsx"
      to: "/apps/tasks/completed"
      via: "router.push with correct path prefix"
      pattern: "/apps/tasks/completed"
---

<objective>
Create the Tasks route group under /apps/tasks/ with the shared layout (sidebar, billing, auth guard) and all sub-page routes, replacing the current redirect-to-external page.

Purpose: Make the full Tasks UI accessible at /apps/tasks and all sub-routes inside the personal-brand app shell.
Output: 12 route/component files under src/app/apps/tasks/
</objective>

<execution_context>
@/Users/dweinbeck/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dweinbeck/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/45-ui-components-routing/45-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Tasks layout with sidebar, billing, and auth integration</name>
  <files>
    src/app/apps/tasks/layout.tsx
    src/app/apps/tasks/page.tsx
  </files>
  <action>
**1. src/app/apps/tasks/layout.tsx** — Replace the existing redirect page.tsx with a proper layout. Adapt from /Users/dweinbeck/ai/todoist/src/app/tasks/layout.tsx with these import path changes:

- `@/components/auth/AuthGuard` -> `@/components/tasks/auth/AuthGuard`
- `@/components/billing/BillingProvider` -> `@/components/tasks/billing/BillingProvider`
- `@/components/billing/FreeWeekBanner` -> `@/components/tasks/billing/FreeWeekBanner`
- `@/components/billing/ReadOnlyBanner` -> `@/components/tasks/billing/ReadOnlyBanner`
- `@/components/tasks/sidebar` -> `@/components/tasks/sidebar` (same)
- `@/lib/auth` -> `@/lib/tasks/auth` (for getUserIdFromCookie)
- `@/lib/billing` -> `@/lib/tasks/billing` (for checkBillingAccess)
- `@/services/tag.service` -> `@/services/tasks/tag.service`
- `@/services/workspace.service` -> `@/services/tasks/workspace.service`
- `@/types` -> `@/lib/tasks/types` (for SidebarWorkspace)

The layout structure is: AuthGuard wraps unauthenticated users, BillingProvider wraps billing context, Sidebar renders on the left, main content area on the right with ReadOnlyBanner/FreeWeekBanner conditionally shown.

Change the BILLING_URL fallback from `"https://dan-weinbeck.com/billing"` to `"/billing"` (internal route since we're now in the same app).

The layout.tsx uses `flex h-screen` which creates a full-height sidebar layout. This is correct -- it should NOT use the personal-brand Navbar/Footer since the Tasks app has its own sidebar-based layout.

**2. src/app/apps/tasks/page.tsx** — Replace the existing redirect page with the Tasks landing page. Copy from /Users/dweinbeck/ai/todoist/src/app/tasks/page.tsx with these changes:
- `@/lib/auth` -> `@/lib/tasks/auth`
- `@/services/workspace.service` -> `@/services/tasks/workspace.service`
- Change `redirect("/")` to `redirect("/apps/tasks")` -- actually, on the landing page if user is not authenticated, they should see the AuthGuard (handled by layout), so change redirect to just return null or redirect to home. Actually, looking at the source: the layout already wraps with AuthGuard, so the page.tsx redirect for !userId is belt-and-suspenders. Change the redirect to `redirect("/")` (personal-brand home).
  </action>
  <verify>
Run `npm run build` to check layout and page compile. Verify the import paths are all correct with no "module not found" errors. Verify visiting /apps/tasks no longer redirects to an external URL.
  </verify>
  <done>
Layout.tsx creates the sidebar + main content layout with auth, billing, and sidebar integration. Page.tsx shows the Tasks landing page for authenticated users. No redirect to external URL.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create all sub-route pages</name>
  <files>
    src/app/apps/tasks/[projectId]/page.tsx
    src/app/apps/tasks/[projectId]/project-view.tsx
    src/app/apps/tasks/today/page.tsx
    src/app/apps/tasks/completed/page.tsx
    src/app/apps/tasks/completed/completed-view.tsx
    src/app/apps/tasks/search/page.tsx
    src/app/apps/tasks/search/search-input.tsx
    src/app/apps/tasks/tags/page.tsx
    src/app/apps/tasks/tags/tag-list.tsx
    src/app/apps/tasks/tags/[tagId]/page.tsx
  </files>
  <action>
Copy all sub-route pages from /Users/dweinbeck/ai/todoist/src/app/tasks/ to src/app/apps/tasks/ with the following import and path adaptations applied to EVERY file:

**Import path changes (apply to ALL files):**
- `@/lib/auth` -> `@/lib/tasks/auth` (getUserIdFromCookie)
- `@/lib/effort` -> `@/lib/tasks/effort`
- `@/lib/utils` -> `@/lib/utils`
- `@/lib/demo` -> `@/lib/tasks/demo`
- `@/services/tag.service` -> `@/services/tasks/tag.service`
- `@/services/task.service` -> `@/services/tasks/task.service`
- `@/services/project.service` -> `@/services/tasks/project.service`
- `@/services/workspace.service` -> `@/services/tasks/workspace.service`
- `@/components/tasks/task-card` -> `@/components/tasks/task-card` (already correct)
- `@/components/tasks/add-section-button` -> `@/components/tasks/add-section-button` (already correct)
- `@/components/tasks/add-task-button` -> `@/components/tasks/add-task-button` (already correct)
- `@/components/tasks/board-view` -> `@/components/tasks/board-view` (already correct)
- `@/components/tasks/section-header` -> `@/components/tasks/section-header` (already correct)
- `@/components/ui/badge` -> `@/components/tasks/ui/badge`
- `@/components/ui/button` -> `@/components/tasks/ui/button`
- `@/components/ui/input` -> `@/components/tasks/ui/input`
- `@/components/ui/confirm-dialog` -> `@/components/tasks/ui/confirm-dialog`
- `@/actions/project` -> `@/actions/tasks/project`
- `@/actions/section` -> `@/actions/tasks/section`
- `@/actions/task` -> `@/actions/tasks/task`
- `@/actions/tag` -> `@/actions/tasks/tag`
- `@/context/AuthContext` -> `@/context/AuthContext` (same path)
- `@/types` -> `@/lib/tasks/types`

**Route path changes (critical for URL correctness):**
- In `completed-view.tsx`: Change `router.push(\`/tasks/completed?...\`)` to `router.push(\`/apps/tasks/completed?...\`)`
- In `search-input.tsx`: Change `router.push(\`/tasks/search?...\`)` to `router.push(\`/apps/tasks/search?...\`)`
- In `tag-list.tsx`: Change `\`/tasks/tags/${tag.id}\`` to `\`/apps/tasks/tags/${tag.id}\``
- In all page.tsx files: Change `redirect("/")` to `redirect("/")` (redirect to personal-brand home, not todoist home)

**Files to create with source -> destination mapping:**

1. `src/app/apps/tasks/[projectId]/page.tsx` <- todoist/src/app/tasks/[projectId]/page.tsx
2. `src/app/apps/tasks/[projectId]/project-view.tsx` <- todoist/src/app/tasks/[projectId]/project-view.tsx
3. `src/app/apps/tasks/today/page.tsx` <- todoist/src/app/tasks/today/page.tsx
4. `src/app/apps/tasks/completed/page.tsx` <- todoist/src/app/tasks/completed/page.tsx
5. `src/app/apps/tasks/completed/completed-view.tsx` <- todoist/src/app/tasks/completed/completed-view.tsx
6. `src/app/apps/tasks/search/page.tsx` <- todoist/src/app/tasks/search/page.tsx
7. `src/app/apps/tasks/search/search-input.tsx` <- todoist/src/app/tasks/search/search-input.tsx
8. `src/app/apps/tasks/tags/page.tsx` <- todoist/src/app/tasks/tags/page.tsx
9. `src/app/apps/tasks/tags/tag-list.tsx` <- todoist/src/app/tasks/tags/tag-list.tsx
10. `src/app/apps/tasks/tags/[tagId]/page.tsx` <- todoist/src/app/tasks/tags/[tagId]/page.tsx

Create directories as needed: [projectId]/, today/, completed/, search/, tags/, tags/[tagId]/.
  </action>
  <verify>
Run `npm run build` to verify all routes compile and resolve. Grep for `"/tasks/` (without /apps prefix) in src/app/apps/tasks/ to ensure all route paths were updated -- should find ZERO matches except for CSS class names containing "tasks". Grep for `@/services/tag.service"` (without /tasks/) in src/app/apps/tasks/ -- should find ZERO matches. Run `npm run lint` to verify import ordering.
  </verify>
  <done>
All 10 sub-route files exist under src/app/apps/tasks/. Every file uses personal-brand import paths. All internal navigation uses /apps/tasks/ prefix. All service imports point to @/services/tasks/*. Build and lint pass.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` passes with zero errors
2. `npm run lint` passes with zero errors
3. All route pages exist: layout, page, [projectId], today, completed, search, tags, tags/[tagId]
4. No references to bare `/tasks/` paths (without /apps prefix) in route files
5. No references to todoist-specific imports (@/services/tag.service without /tasks/)
6. Layout includes sidebar, billing provider, auth guard
</verification>

<success_criteria>
- 12 files created under src/app/apps/tasks/
- Build and lint pass
- All routes compile and render server components correctly
- Sidebar visible in layout with /apps/tasks/ navigation
- No external redirect on /apps/tasks
</success_criteria>

<output>
After completion, create `.planning/phases/45-ui-components-routing/45-02-SUMMARY.md`
</output>
