---
phase: 44-server-side-code-migration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/schemas/tasks/workspace.ts
  - src/lib/schemas/tasks/project.ts
  - src/lib/schemas/tasks/section.ts
  - src/lib/schemas/tasks/task.ts
  - src/lib/schemas/tasks/tag.ts
  - src/services/tasks/workspace.service.ts
  - src/services/tasks/project.service.ts
  - src/services/tasks/section.service.ts
  - src/services/tasks/task.service.ts
  - src/services/tasks/tag.service.ts
autonomous: true
requirements: [MIG-03]

must_haves:
  truths:
    - "Zod validation schemas reject invalid input with the same error messages as the standalone app"
    - "Service layer functions can query and mutate the PostgreSQL database via Prisma"
    - "Schema type exports (CreateWorkspaceInput, etc.) are available for import by services and actions"
  artifacts:
    - path: "src/lib/schemas/tasks/workspace.ts"
      provides: "Workspace validation schemas"
      exports: ["createWorkspaceSchema", "updateWorkspaceSchema", "CreateWorkspaceInput", "UpdateWorkspaceInput"]
    - path: "src/lib/schemas/tasks/project.ts"
      provides: "Project validation schemas"
      exports: ["createProjectSchema", "updateProjectSchema", "updateProjectViewModeSchema"]
    - path: "src/lib/schemas/tasks/section.ts"
      provides: "Section validation schemas"
      exports: ["createSectionSchema", "updateSectionSchema", "reorderSectionSchema"]
    - path: "src/lib/schemas/tasks/task.ts"
      provides: "Task validation schemas"
      exports: ["createTaskSchema", "updateTaskSchema", "reorderTaskSchema"]
    - path: "src/lib/schemas/tasks/tag.ts"
      provides: "Tag validation schemas"
      exports: ["createTagSchema", "updateTagSchema"]
    - path: "src/services/tasks/workspace.service.ts"
      provides: "Workspace CRUD via Prisma"
      exports: ["getWorkspaces", "getWorkspace", "createWorkspace", "updateWorkspace", "deleteWorkspace"]
    - path: "src/services/tasks/project.service.ts"
      provides: "Project CRUD via Prisma"
      exports: ["getAllProjects", "getProject", "createProject", "updateProject", "updateProjectViewMode", "deleteProject"]
    - path: "src/services/tasks/section.service.ts"
      provides: "Section CRUD via Prisma"
      exports: ["createSection", "updateSection", "deleteSection", "reorderSection"]
    - path: "src/services/tasks/task.service.ts"
      provides: "Task CRUD + queries via Prisma"
      exports: ["createTask", "updateTask", "deleteTask", "toggleTaskStatus", "assignTaskToSection", "reorderTask", "getTasksForToday", "getCompletedTasks", "searchTasks"]
    - path: "src/services/tasks/tag.service.ts"
      provides: "Tag CRUD + task-by-tag query via Prisma"
      exports: ["getTags", "createTag", "updateTag", "deleteTag", "getTasksByTag"]
  key_links:
    - from: "src/services/tasks/workspace.service.ts"
      to: "src/lib/prisma.ts"
      via: "import { prisma }"
      pattern: "import.*prisma.*from.*@/lib/prisma"
    - from: "src/services/tasks/workspace.service.ts"
      to: "src/lib/schemas/tasks/workspace.ts"
      via: "type imports"
      pattern: "import type.*from.*@/lib/schemas/tasks/workspace"
---

<objective>
Copy Zod validation schemas and Prisma service layer from the standalone Tasks app into the personal-brand codebase.

Purpose: Provides the data validation and database access layers that server actions (Plan 03) will depend on. Schemas validate all CRUD input; services execute Prisma queries against the shared PostgreSQL database.
Output: 5 schema files in `src/lib/schemas/tasks/` and 5 service files in `src/services/tasks/`
</objective>

<execution_context>
@/Users/dweinbeck/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dweinbeck/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/lib/prisma.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Copy Zod validation schemas for all 5 Tasks entities</name>
  <files>
    src/lib/schemas/tasks/workspace.ts
    src/lib/schemas/tasks/project.ts
    src/lib/schemas/tasks/section.ts
    src/lib/schemas/tasks/task.ts
    src/lib/schemas/tasks/tag.ts
  </files>
  <action>
Create directory `src/lib/schemas/tasks/` and copy the 5 Zod schema files from the todoist source at `/Users/dweinbeck/ai/todoist/src/lib/schemas/`. These files are pure Zod definitions with NO import path changes needed -- they only import `{ z } from "zod"` which is already available in personal-brand (same Zod 4.3.6 version).

Copy each file exactly as-is:
- `workspace.ts` — createWorkspaceSchema, updateWorkspaceSchema + type exports
- `project.ts` — createProjectSchema, updateProjectSchema, updateProjectViewModeSchema + type exports
- `section.ts` — createSectionSchema, updateSectionSchema, reorderSectionSchema + type exports
- `task.ts` — createTaskSchema, updateTaskSchema, reorderTaskSchema + type exports (includes effort enum: 1,2,3,5,8,13)
- `tag.ts` — createTagSchema, updateTagSchema + type exports

No modifications needed. These are self-contained Zod schemas with no external dependencies beyond `zod`.
  </action>
  <verify>Run `npx tsc --noEmit` and confirm no type errors in the new schema files. Verify each schema file exports the expected schemas and types.</verify>
  <done>All 5 schema files exist in src/lib/schemas/tasks/ with identical validation rules to the todoist source. Type exports (CreateWorkspaceInput, etc.) are importable.</done>
</task>

<task type="auto">
  <name>Task 2: Copy and adapt service layer for all 5 Tasks entities</name>
  <files>
    src/services/tasks/workspace.service.ts
    src/services/tasks/project.service.ts
    src/services/tasks/section.service.ts
    src/services/tasks/task.service.ts
    src/services/tasks/tag.service.ts
  </files>
  <action>
Create directory `src/services/tasks/` and copy the 5 service files from `/Users/dweinbeck/ai/todoist/src/services/`. Each file needs TWO import path changes:

1. **Prisma import:** Change `import { prisma } from "@/lib/db"` to `import { prisma } from "@/lib/prisma"` (personal-brand's Prisma singleton created in Phase 43)
2. **Schema type imports:** Change `from "@/lib/schemas/..."` to `from "@/lib/schemas/tasks/..."` (new nested path)

Specific files and their imports to update:

**workspace.service.ts:**
- `import { prisma } from "@/lib/prisma";`
- `import type { CreateWorkspaceInput, UpdateWorkspaceInput } from "@/lib/schemas/tasks/workspace";`
- All function bodies remain identical (Prisma queries unchanged)

**project.service.ts:**
- `import { prisma } from "@/lib/prisma";`
- `import type { CreateProjectInput, UpdateProjectInput } from "@/lib/schemas/tasks/project";`
- All function bodies remain identical

**section.service.ts:**
- `import { prisma } from "@/lib/prisma";`
- `import type { CreateSectionInput, ReorderSectionInput, UpdateSectionInput } from "@/lib/schemas/tasks/section";`
- All function bodies remain identical

**task.service.ts:**
- `import { prisma } from "@/lib/prisma";`
- `import type { CreateTaskInput, ReorderTaskInput, UpdateTaskInput } from "@/lib/schemas/tasks/task";`
- All function bodies remain identical (all 9 functions: createTask, updateTask, deleteTask, toggleTaskStatus, assignTaskToSection, reorderTask, getTasksForToday, getCompletedTasks, searchTasks)

**tag.service.ts:**
- `import { prisma } from "@/lib/prisma";`
- `import type { CreateTagInput, UpdateTagInput } from "@/lib/schemas/tasks/tag";`
- All function bodies remain identical (5 functions: getTags, createTag, updateTag, deleteTag, getTasksByTag)

IMPORTANT: Do NOT add "use server" to service files. They are plain modules imported by server actions, not server actions themselves. Do NOT modify any Prisma query logic.
  </action>
  <verify>Run `npx tsc --noEmit` and confirm no type errors. Verify each service file correctly imports from `@/lib/prisma` and `@/lib/schemas/tasks/...`.</verify>
  <done>All 5 service files exist in src/services/tasks/ with corrected import paths. Each service can be imported by server actions. Prisma queries are identical to the todoist source.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. All 10 files (5 schemas + 5 services) exist at their target paths
3. No service file imports from `@/lib/db` (todoist path) -- all use `@/lib/prisma`
4. No schema file has modified validation rules -- exact same Zod definitions as todoist source
5. Schema type exports are accessible: `import type { CreateTaskInput } from "@/lib/schemas/tasks/task"` resolves
</verification>

<success_criteria>
- 5 Zod schema files copied to src/lib/schemas/tasks/ with identical validation logic
- 5 service files copied to src/services/tasks/ with updated import paths
- TypeScript compilation succeeds
- All Prisma queries unchanged from todoist source
</success_criteria>

<output>
After completion, create `.planning/phases/44-server-side-code-migration/44-01-SUMMARY.md`
</output>
