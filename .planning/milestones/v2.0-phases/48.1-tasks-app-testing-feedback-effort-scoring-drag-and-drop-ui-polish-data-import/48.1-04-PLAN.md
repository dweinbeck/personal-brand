---
phase: 48.1-tasks-app-testing-feedback
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/apps/tasks/(authenticated)/[projectId]/project-view.tsx
  - src/actions/tasks/task.ts
  - src/services/tasks/task.service.ts
autonomous: true
requirements: [TF-03]

must_haves:
  truths:
    - "Users can drag tasks between sections in list view"
    - "Drag-and-drop is always available without needing edit mode"
    - "Tasks dropped in a new section are moved to that section"
    - "Tasks can be dragged to the unsectioned area"
  artifacts:
    - path: "src/app/apps/tasks/(authenticated)/[projectId]/project-view.tsx"
      provides: "Project view with drag-and-drop between sections"
      contains: "onDragStart"
    - path: "src/actions/tasks/task.ts"
      provides: "Server action for moving tasks between sections"
      contains: "assignTaskToSectionAction"
  key_links:
    - from: "src/app/apps/tasks/(authenticated)/[projectId]/project-view.tsx"
      to: "src/actions/tasks/task.ts"
      via: "assignTaskToSectionAction call on drop"
      pattern: "assignTaskToSectionAction"
---

<objective>
Add drag-and-drop task reordering between sections in the Tasks list view using native HTML5 drag and drop (no external library needed).

Purpose: Users need to move tasks between sections by clicking and dragging, always available without entering an "edit mode" first.
Output: List view supports drag-and-drop between sections using native browser DnD API.
</objective>

<execution_context>
@/Users/dweinbeck/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dweinbeck/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/app/apps/tasks/(authenticated)/[projectId]/project-view.tsx
@src/components/tasks/task-card.tsx
@src/actions/tasks/task.ts
@src/services/tasks/task.service.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement HTML5 drag-and-drop between sections in list view</name>
  <files>
    src/app/apps/tasks/(authenticated)/[projectId]/project-view.tsx
  </files>
  <action>
    Use the native HTML5 Drag and Drop API (no external library needed). The `assignTaskToSectionAction` server action already exists in `src/actions/tasks/task.ts` and handles moving a task to a different section (or to null for unsectioned).

    **Add drag state to ProjectView:**
    ```tsx
    const [draggingTaskId, setDraggingTaskId] = useState<string | null>(null);
    const [dragOverSection, setDragOverSection] = useState<string | "unsectioned" | null>(null);
    ```

    **Wrap each TaskCard in a draggable container:**

    For both unsectioned tasks and section tasks in the list view, wrap each `<TaskCard>` in a `<div>` with:
    ```tsx
    <div
      draggable
      onDragStart={(e) => {
        setDraggingTaskId(task.id);
        e.dataTransfer.effectAllowed = "move";
        e.dataTransfer.setData("text/plain", task.id);
      }}
      onDragEnd={() => {
        setDraggingTaskId(null);
        setDragOverSection(null);
      }}
      className={cn(
        "transition-opacity",
        draggingTaskId === task.id && "opacity-50"
      )}
    >
      <TaskCard ... />
    </div>
    ```

    **Add drop zones on each section and the unsectioned area:**

    For the unsectioned tasks area (the div containing `project.tasks`), add:
    ```tsx
    <div
      onDragOver={(e) => {
        e.preventDefault();
        e.dataTransfer.dropEffect = "move";
        setDragOverSection("unsectioned");
      }}
      onDragLeave={() => setDragOverSection(null)}
      onDrop={async (e) => {
        e.preventDefault();
        const taskId = e.dataTransfer.getData("text/plain");
        if (taskId) {
          const token = await user!.getIdToken();
          await assignTaskToSectionAction(token, taskId, null);
        }
        setDraggingTaskId(null);
        setDragOverSection(null);
      }}
      className={cn(
        "mb-6 min-h-[40px] rounded-lg transition-colors",
        dragOverSection === "unsectioned" && draggingTaskId && "bg-gold-light/30 ring-2 ring-gold/30 ring-dashed"
      )}
    >
      ...existing unsectioned tasks content...
    </div>
    ```

    For each section, wrap the section's task list area similarly:
    ```tsx
    <div
      onDragOver={(e) => {
        e.preventDefault();
        e.dataTransfer.dropEffect = "move";
        setDragOverSection(section.id);
      }}
      onDragLeave={() => setDragOverSection(null)}
      onDrop={async (e) => {
        e.preventDefault();
        const taskId = e.dataTransfer.getData("text/plain");
        if (taskId) {
          const token = await user!.getIdToken();
          await assignTaskToSectionAction(token, taskId, section.id);
        }
        setDraggingTaskId(null);
        setDragOverSection(null);
      }}
      className={cn(
        "min-h-[40px] rounded-lg transition-colors",
        dragOverSection === section.id && draggingTaskId && "bg-gold-light/30 ring-2 ring-gold/30 ring-dashed"
      )}
    >
      ...existing section tasks content...
    </div>
    ```

    Import `assignTaskToSectionAction` from `@/actions/tasks/task` at the top of the file.

    The visual indicator for the drop zone is a subtle gold highlight with a dashed ring, consistent with the app's design language.

    **Important:** Only apply drag-and-drop in list view mode. The board view already has a different layout. Wrap the drag handlers in a check: only attach drag event handlers when `viewMode === "list"`.

    **Edge case:** If a task is dropped on the same section it's already in, the `assignTaskToSectionAction` will still run but it's a no-op (updates sectionId to same value). This is acceptable for simplicity.
  </action>
  <verify>
    - `npm run lint` passes
    - `npm run build` passes
    - ProjectView uses draggable attribute on task wrappers
    - Drop handlers call assignTaskToSectionAction
    - Drag visual indicators use gold-light styling
    - Drag-and-drop only active in list view
  </verify>
  <done>
    1. Tasks can be dragged between sections in list view by clicking and dragging
    2. Drop zones highlight with a gold ring when a task is dragged over them
    3. Dropping a task calls the existing assignTaskToSectionAction server action
    4. Always available — no edit mode needed
    5. Works for moving tasks to/from the unsectioned area and any named section
  </done>
</task>

</tasks>

<verification>
- `npm run lint && npm run build && npm test` — all pass
- Drag-and-drop works in list view
- Tasks move between sections on drop
- Visual indicators appear during drag
</verification>

<success_criteria>
1. Tasks can be dragged between sections in list view
2. Drop zones show visual indicator during drag-over
3. Server action fires on drop to persist the section change
4. No external DnD library needed (native HTML5 API)
5. Build, lint, and tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/48.1-tasks-app-testing-feedback-effort-scoring-drag-and-drop-ui-polish-data-import/48.1-04-SUMMARY.md`
</output>
